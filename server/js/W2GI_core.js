Event.pointerX=function(a){var b=document.documentElement,c=document.body||{scrollLeft:0};return a.changedTouches?a.changedTouches[0].clientX+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0):a.pageX||a.clientX+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0)};
Event.pointerY=function(a){var b=document.documentElement,c=document.body||{scrollTop:0};return a.changedTouches?a.changedTouches[0].clientY+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0):a.pageY||a.clientY+(b.scrollTop||c.scrollTop)-(b.clientTop||0)};
Object.extend(Form,{deserialize:function(a,b){b=decodeURIComponent(b);b.split("&").each(function(b){var d=b.split("="),b=Form.getElements(a).findAll(function(a){return a.name==d[0]}),e=d[1];d[0]!=a.readAttribute("id")&&("undefined"!=e&&null!=e)&&Form.Element.deserialize(b,e)});Form.getElements(a).each(function(a){a.removeAttribute("processed")})}});Object.extend(Form.Element,{deserialize:function(a,b){if(a&&a[0]){var c=a[0].tagName.toLowerCase();Form.Element.Deserializers[c](a,b)}}});
Form.Element.Deserializers={input:function(a,b){switch(a[0].type.toLowerCase()){case "submit":case "hidden":case "password":case "text":return Form.Element.Deserializers.textarea(a,b);case "checkbox":return Form.Element.Deserializers.checkboxSelector(a,b);case "radio":return Form.Element.Deserializers.radioSelector(a,b);case "select":return Form.Element.Deserializers.selectOne(a,b)}return!1},radioSelector:function(a,b){$A(a).each(function(a){a.value==b&&(a.checked=!0)})},checkboxSelector:function(a,
b){$A(a).each(function(a){a.value==b&&(a.checked=!0)})},textarea:function(a,b){a.each(function(a){if(!a.getAttribute("processed"))throw a.value=b,a.setAttribute("processed","1"),$break;})},select:function(a,b){return Form.Element.Deserializers["select-one"==a[0].type?"selectOne":"selectMany"](a,b)},selectOne:function(a,b){a.each(function(a){if(!a.getAttribute("processed"))throw a.value=b,$A(a.options).each(function(a){a.value==b&&(a.selected=!0)}.bind(this)),a.setAttribute("processed","1"),$break;
}.bind(this))},selectMany:function(a,b){var c=a[0];for(i=0;i<c.options.length;i++){var d=c.options[i];d.value==b&&(d.selected=!0)}}};Element.addMethods({populate:function(a,b){var c=a.cloneNode(!0);c.innerHTML=a.innerHTML.interpolate(b);return c},applyFilter:function(a){var b=a.src;!b.endsWith("/w2gi/images/spacer.png")&&void 0!=b&&(a._src=b,a.src="/w2gi/images/spacer.png",a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b+"',sizingMethod='scale')");return a}});
Object.extend(Prototype.Browser,{IE:/MSIE/.test(navigator.userAgent),IEVersion:parseFloat(navigator.appVersion.split("MSIE")[1])});Object.extend(Prototype.Browser,{IE6:Prototype.Browser.IE&&5.5<Prototype.Browser.IEVersion&&7>Prototype.Browser.IEVersion});Prototype.Browser.WebKit&&(String.prototype.localeCompare=function(a){return this<a?-1:this>a?1:0});
Ajax.Responders.register({onCreate:function(){var a=$("ajax_activity");a&&a.show()},onComplete:function(){if(0>=Ajax.activeRequestCount){var a=$("ajax_activity");a&&a.hide()}}});
Object.extend(Function.prototype,{bind:function(){if(2>arguments.length&&void 0===arguments[0])return this;var a=this,b=$A(arguments),c=b.shift();return function(){if("function"===typeof $A)return a.apply(c,b.concat($A(arguments)))}},bindAsEventListener:function(){var a=this,b=$A(arguments),c=b.shift();return function(d){if("function"===typeof $A)return a.apply(c,[d||window.event].concat(b))}}});
Object.extend(String.prototype,{evalJSON:function(a){var b=this.unfilterJSON(),c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;c.test(b)&&(b=b.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));try{if(!a||b.isJSON())return eval("("+b+")")}catch(d){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}});
String.prototype.parseColor=function(a){var b="#";if("rgb("==this.slice(0,4)){var c=this.slice(4,this.length-1).split(","),d=0;do b+=parseInt(c[d]).toColorPart();while(3>++d)}else if("#"==this.slice(0,1)){if(4==this.length)for(d=1;4>d;d++)b+=(this.charAt(d)+this.charAt(d)).toLowerCase();7==this.length&&(b=this.toLowerCase())}return 7==b.length?b:a||this};
Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(a){return 3==a.nodeType?a.nodeValue:a.hasChildNodes()?Element.collectTextNodes(a):""}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(a){return 3==a.nodeType?a.nodeValue:a.hasChildNodes()&&!Element.hasClassName(a,b)?Element.collectTextNodesIgnoreClass(a,b):""}).flatten().join("")};
Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:b/100+"em"});Prototype.Browser.WebKit&&window.scrollBy(0,0);return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{var a=$(a),b=document.createTextNode(" ");a.appendChild(b);a.removeChild(b)}catch(c){}};
var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},flicker:function(a){a=-Math.cos(a*Math.PI)/4+0.75+Math.random()/4;return 1<a?1:a},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){return-Math.cos(2*(a*((b||5)-0.5))*Math.PI)/2+0.5},spring:function(a){return 1-
Math.cos(4.5*a*Math.PI)*Math.exp(6*-a)},none:function(){return 0},full:function(){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";Prototype.Browser.IE&&(b+=";zoom:1");a=$(a);$A(a.childNodes).each(function(c){3==c.nodeType&&(c.nodeValue.toArray().each(function(d){a.insertBefore((new Element("span",{style:b})).update(" "==d?String.fromCharCode(160):d),c)}),Element.remove(c))})},multiple:function(a,b,c){var a=
("object"==typeof a||Object.isFunction(a))&&a.length?a:$(a).childNodes,d=Object.extend({speed:0.1,delay:0},c||{}),e=d.delay;$A(a).each(function(a,c){new b(a,Object.extend(d,{delay:c*d.speed+e}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(a,b,c){a=$(a);b=(b||"appear").toLowerCase();return Effect[Effect.PAIRS[b][a.visible()?1:0]](a,Object.extend({queue:{position:"end",scope:a.id||"global",limit:1}},c||{}))}};
Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;
Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(a){var b=(new Date).getTime();switch(Object.isString(a.options.queue)?a.options.queue:a.options.queue.position){case "front":this.effects.findAll(function(a){return"idle"==a.state}).each(function(b){b.startOn+=a.finishOn;b.finishOn+=a.finishOn});break;case "with-last":b=this.effects.pluck("startOn").max()||b;break;case "end":b=this.effects.pluck("finishOn").max()||
b}a.startOn+=b;a.finishOn+=b;(!a.options.queue.limit||this.effects.length<a.options.queue.limit)&&this.effects.push(a);this.interval||(this.interval=setInterval(this.loop.bind(this),15))},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});0==this.effects.length&&(clearInterval(this.interval),this.interval=null)},loop:function(){for(var a=(new Date).getTime(),b=0,c=this.effects.length;b<c;b++)this.effects[b]&&this.effects[b].loop(a)}});
Effect.Queues={instances:$H(),get:function(a){return!Object.isString(a)?a:this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue)}};Effect.Queue=Effect.Queues.get("global");
Effect.Base=Class.create({position:null,start:function(a){a&&!1===a.transition&&(a.transition=Effect.Transitions.linear);this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=1E3*this.options.delay;this.finishOn=this.startOn+1E3*this.options.duration;this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;var b=function(a,b){if(a.options[b+
"Internal"])a.options[b+"Internal"](a);if(a.options[b])a.options[b](a)};this.render=function(a){"idle"===this.state&&(this.state="running",b(this,"beforeSetup"),this.setup&&this.setup(),b(this,"afterSetup"));"running"===this.state&&(this.position=a=this.options.transition(a)*this.fromToDelta+this.options.from,b(this,"beforeUpdate"),this.update&&this.update(a),b(this,"afterUpdate"))};this.event("beforeStart");this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},
loop:function(a){if(a>=this.startOn)if(a>=this.finishOn)this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),this.event("afterFinish");else{var a=(a-this.startOn)/this.totalTime,b=(a*this.totalFrames).round();b>this.currentFrame&&(this.render(a),this.currentFrame=b)}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);this.state="finished"},event:function(a){if(this.options[a+"Internal"])this.options[a+
"Internal"](this);if(this.options[a])this.options[a](this)},inspect:function(){var a=$H();for(property in this)Object.isFunction(this[property])||a.set(property,this[property]);return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});
Effect.Parallel=Class.create(Effect.Base,{initialize:function(a,b){this.effects=a||[];this.start(b)},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");b.finish&&b.finish(a);b.event("afterFinish")})}});
Effect.Tween=Class.create(Effect.Base,{initialize:function(a,b,c){var a=Object.isString(a)?$(a):a,d=$A(arguments),e=d.last(),d=5==d.length?d[3]:null;this.method=Object.isFunction(e)?e.bind(a):Object.isFunction(a[e])?a[e].bind(a):function(b){a[e]=b};this.start(Object.extend({from:b,to:c},d||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(a){this.start(Object.extend({duration:0},a||{}))},update:Prototype.emptyFunction});
Effect.Opacity=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});var c=Object.extend({from:this.element.getOpacity()||0,to:1},b||{});this.start(c)},update:function(a){this.element.setOpacity(a)}});
Effect.Move=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({x:0,y:0,mode:"relative"},b||{});this.start(c)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");"absolute"==this.options.mode&&(this.options.x-=this.originalLeft,this.options.y-=this.originalTop)},update:function(a){this.element.setStyle({left:(this.options.x*
a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(a,b,c,d){return new Effect.Move(a,Object.extend({x:c,y:b},d||{}))};
Effect.Scale=Class.create(Effect.Base,{initialize:function(a,b,c){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;a=Object.extend({scaleX:!0,scaleY:!0,scaleContent:!0,scaleFromCenter:!1,scaleMode:"box",scaleFrom:100,scaleTo:b},c||{});this.start(a)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||!1;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(a){this.originalStyle[a]=
this.element.style[a]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){0<a.indexOf(b)&&(this.fontSize=parseFloat(a),this.fontSizeType=b)}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;"box"==this.options.scaleMode&&(this.dims=[this.element.offsetHeight,this.element.offsetWidth]);/^content/.test(this.options.scaleMode)&&(this.dims=
[this.element.scrollHeight,this.element.scrollWidth]);this.dims||(this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth])},update:function(a){a=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*a+this.fontSizeType});this.setDimensions(this.dims[0]*a,this.dims[1]*a)},finish:function(){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(a,b){var c={};
this.options.scaleX&&(c.width=b.round()+"px");this.options.scaleY&&(c.height=a.round()+"px");if(this.options.scaleFromCenter){var d=(a-this.dims[0])/2,e=(b-this.dims[1])/2;"absolute"==this.elementPositioning?(this.options.scaleY&&(c.top=this.originalTop-d+"px"),this.options.scaleX&&(c.left=this.originalLeft-e+"px")):(this.options.scaleY&&(c.top=-d+"px"),this.options.scaleX&&(c.left=-e+"px"))}this.element.setStyle(c)}});
Effect.Highlight=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({startcolor:"#ffff99"},b||{});this.start(c)},setup:function(){"none"==this.element.getStyle("display")?this.cancel():(this.oldStyle={},this.options.keepBackgroundImage||(this.oldStyle.backgroundImage=this.element.getStyle("background-image"),this.element.setStyle({backgroundImage:"none"})),this.options.endcolor||(this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")),
this.options.restorecolor||(this.options.restorecolor=this.element.getStyle("background-color")),this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(2*a+1,2*a+3),16)}.bind(this)),this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(2*a+1,2*a+3),16)-this._base[a]}.bind(this)))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+(this._base[d]+this._delta[d]*a).round().toColorPart()}.bind(this))})},
finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(a,b){var c=b||{},d=document.viewport.getScrollOffsets(),e=$(a).cumulativeOffset();c.offset&&(e[1]+=c.offset);return new Effect.Tween(null,d.top,e[1],c,function(a){scrollTo(d.left,a.round())})};
Effect.Fade=function(a,b){var a=$(a),c=a.getInlineOpacity(),d=Object.extend({from:a.getOpacity()||1,to:0,afterFinishInternal:function(a){0==a.options.to&&a.element.hide().setStyle({opacity:c})}},b||{});return new Effect.Opacity(a,d)};
Effect.Appear=function(a,b){var a=$(a),c=Object.extend({from:"none"==a.getStyle("display")?0:a.getOpacity()||0,to:1,afterFinishInternal:function(a){a.element.forceRerendering()},beforeSetup:function(a){a.element.setOpacity(a.options.from).show()}},b||{});return new Effect.Opacity(a,c)};
Effect.Puff=function(a,b){var a=$(a),c={opacity:a.getInlineOpacity(),position:a.getStyle("position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return new Effect.Parallel([new Effect.Scale(a,200,{sync:!0,scaleFromCenter:!0,scaleContent:!0,restoreAfterFinish:!0}),new Effect.Opacity(a,{sync:!0,to:0})],Object.extend({duration:1,beforeSetupInternal:function(a){Position.absolutize(a.effects[0].element)},afterFinishInternal:function(a){a.effects[0].element.hide().setStyle(c)}},
b||{}))};Effect.BlindUp=function(a,b){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:!1,scaleX:!1,restoreAfterFinish:!0,afterFinishInternal:function(a){a.element.hide().undoClipping()}},b||{}))};
Effect.BlindDown=function(a,b){var a=$(a),c=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:0,scaleMode:{originalHeight:c.height,originalWidth:c.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(a){a.element.undoClipping()}},b||{}))};
Effect.SwitchOff=function(a,b){var a=$(a),c=a.getInlineOpacity();return new Effect.Appear(a,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(a){new Effect.Scale(a.element,1,{duration:0.3,scaleFromCenter:!0,scaleX:!1,scaleContent:!1,restoreAfterFinish:!0,beforeSetup:function(a){a.element.makePositioned().makeClipping()},afterFinishInternal:function(a){a.element.hide().undoClipping().undoPositioned().setStyle({opacity:c})}})}},b||{}))};
Effect.DropOut=function(a,b){var a=$(a),c={top:a.getStyle("top"),left:a.getStyle("left"),opacity:a.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(a,{x:0,y:100,sync:!0}),new Effect.Opacity(a,{sync:!0,to:0})],Object.extend({duration:0.5,beforeSetup:function(a){a.effects[0].element.makePositioned()},afterFinishInternal:function(a){a.effects[0].element.hide().undoPositioned().setStyle(c)}},b||{}))};
Effect.Shake=function(a,b){var a=$(a),c=Object.extend({distance:20,duration:0.5},b||{}),d=parseFloat(c.distance),e=parseFloat(c.duration)/10,f={top:a.getStyle("top"),left:a.getStyle("left")};return new Effect.Move(a,{x:d,y:0,duration:e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:2*-d,y:0,duration:2*e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:2*d,y:0,duration:2*e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:2*-d,y:0,duration:2*e,afterFinishInternal:function(a){new Effect.Move(a.element,
{x:2*d,y:0,duration:2*e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:-d,y:0,duration:e,afterFinishInternal:function(a){a.element.undoPositioned().setStyle(f)}})}})}})}})}})}})};
Effect.SlideDown=function(a,b){var a=$(a).cleanWhitespace(),c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makePositioned();a.element.down().makePositioned();window.opera&&a.element.setStyle({top:""});a.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(a){a.element.down().setStyle({bottom:a.dims[0]-
a.element.clientHeight+"px"})},afterFinishInternal:function(a){a.element.undoClipping().undoPositioned();a.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};
Effect.SlideUp=function(a,b){var a=$(a).cleanWhitespace(),c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,window.opera?0:1,Object.extend({scaleContent:!1,scaleX:!1,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makePositioned();a.element.down().makePositioned();window.opera&&a.element.setStyle({top:""});a.element.makeClipping().show()},afterUpdateInternal:function(a){a.element.down().setStyle({bottom:a.dims[0]-
a.element.clientHeight+"px"})},afterFinishInternal:function(a){a.element.hide().undoClipping().undoPositioned();a.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:!0,beforeSetup:function(a){a.element.makeClipping()},afterFinishInternal:function(a){a.element.hide().undoClipping()}})};
Effect.Grow=function(a,b){var a=$(a),c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},e=a.getDimensions(),f,g,h,l;switch(c.direction){case "top-left":f=g=h=l=0;break;case "top-right":f=e.width;g=l=0;h=-e.width;break;case "bottom-left":f=h=0;g=e.height;l=-e.height;break;
case "bottom-right":f=e.width;g=e.height;h=-e.width;l=-e.height;break;case "center":f=e.width/2,g=e.height/2,h=-e.width/2,l=-e.height/2}return new Effect.Move(a,{x:f,y:g,duration:0.01,beforeSetup:function(a){a.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(a){new Effect.Parallel([new Effect.Opacity(a.element,{sync:!0,to:1,from:0,transition:c.opacityTransition}),new Effect.Move(a.element,{x:h,y:l,sync:!0,transition:c.moveTransition}),new Effect.Scale(a.element,100,{scaleMode:{originalHeight:e.height,
originalWidth:e.width},sync:!0,scaleFrom:window.opera?1:0,transition:c.scaleTransition,restoreAfterFinish:!0})],Object.extend({beforeSetup:function(a){a.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(a){a.effects[0].element.undoClipping().undoPositioned().setStyle(d)}},c))}})};
Effect.Shrink=function(a,b){var a=$(a),c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},e=a.getDimensions(),f,g;switch(c.direction){case "top-left":f=g=0;break;case "top-right":f=e.width;g=0;break;case "bottom-left":f=0;g=e.height;break;case "bottom-right":f=e.width;g=
e.height;break;case "center":f=e.width/2,g=e.height/2}return new Effect.Parallel([new Effect.Opacity(a,{sync:!0,to:0,from:1,transition:c.opacityTransition}),new Effect.Scale(a,window.opera?1:0,{sync:!0,transition:c.scaleTransition,restoreAfterFinish:!0}),new Effect.Move(a,{x:f,y:g,sync:!0,transition:c.moveTransition})],Object.extend({beforeStartInternal:function(a){a.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(a){a.effects[0].element.hide().undoClipping().undoPositioned().setStyle(d)}},
c))};Effect.Pulsate=function(a,b){var a=$(a),c=b||{},d=a.getInlineOpacity(),e=c.transition||Effect.Transitions.linear;return new Effect.Opacity(a,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(a){a.element.setStyle({opacity:d})}},c),{transition:function(a){return 1-e(-Math.cos(2*(a*(c.pulses||5))*Math.PI)/2+0.5)}}))};
Effect.Fold=function(a,b){var a=$(a),c={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};a.makeClipping();return new Effect.Scale(a,5,Object.extend({scaleContent:!1,scaleX:!1,afterFinishInternal:function(){new Effect.Scale(a,1,{scaleContent:!1,scaleY:!1,afterFinishInternal:function(a){a.element.hide().undoClipping().setStyle(c)}})}},b||{}))};
Effect.Morph=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({style:{}},b||{});if(Object.isString(c.style))if(c.style.include(":"))this.style=c.style.parseStyle();else{this.element.addClassName(c.style);this.style=$H(this.element.getStyles());this.element.removeClassName(c.style);var d=this.element.getStyles();this.style=this.style.reject(function(a){return a.value==d[a.key]});c.afterFinishInternal=function(a){a.element.addClassName(a.options.style);
a.transforms.each(function(b){a.element.style[b.style]=""})}}else this.style=$H(c.style);this.start(c)},setup:function(){function a(a){if(!a||["rgba(0, 0, 0, 0)","transparent"].include(a))a="#ffffff";a=a.parseColor();return $R(0,2).map(function(c){return parseInt(a.slice(2*c+1,2*c+3),16)})}this.transforms=this.style.map(function(b){var c=b[0],b=b[1],d=null;"#zzzzzz"!=b.parseColor("#zzzzzz")?(b=b.parseColor(),d="color"):"opacity"==c?(b=parseFloat(b),Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&
this.element.setStyle({zoom:1})):Element.CSS_LENGTH.test(b)&&(d=b.match(/^([\+\-]?[0-9\.]+)(.*)$/),b=parseFloat(d[1]),d=3==d.length?d[2]:null);var e=this.element.getStyle(c);return{style:c.camelize(),originalValue:"color"==d?a(e):parseFloat(e||0),targetValue:"color"==d?a(b):b,unit:d}}.bind(this)).reject(function(a){return a.originalValue==a.targetValue||"color"!=a.unit&&(isNaN(a.originalValue)||isNaN(a.targetValue))})},update:function(a){for(var b={},c,d=this.transforms.length;d--;)b[(c=this.transforms[d]).style]=
"color"==c.unit?"#"+Math.round(c.originalValue[0]+(c.targetValue[0]-c.originalValue[0])*a).toColorPart()+Math.round(c.originalValue[1]+(c.targetValue[1]-c.originalValue[1])*a).toColorPart()+Math.round(c.originalValue[2]+(c.targetValue[2]-c.originalValue[2])*a).toColorPart():(c.originalValue+(c.targetValue-c.originalValue)*a).toFixed(3)+(null===c.unit?"":c.unit);this.element.setStyle(b,!0)}});
Effect.Transform=Class.create({initialize:function(a,b){this.tracks=[];this.options=b||{};this.addTracks(a)},addTracks:function(a){a.each(function(a){var a=$H(a),c=a.values().first();this.tracks.push($H({ids:a.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var b=a.get("ids"),c=a.get("effect"),d=a.get("options");return[$(b)||$$(b)].flatten().map(function(a){return new c(a,Object.extend({sync:!0},
d))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");
Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");
String.prototype.parseStyle=function(){var a,b=$H();Prototype.Browser.WebKit?a=(new Element("div",{style:this})).style:(String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>',a=String.__parseStyleElement.childNodes[0].style);Element.CSS_PROPERTIES.each(function(c){a[c]&&b.set(c,a[c])});Prototype.Browser.IE&&this.include("opacity")&&b.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return b};
Element.getStyles=document.defaultView&&document.defaultView.getComputedStyle?function(a){var b=document.defaultView.getComputedStyle($(a),null);return Element.CSS_PROPERTIES.inject({},function(a,d){a[d]=b[d];return a})}:function(a){var a=$(a),b=a.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(a,c){a[c]=b[c];return a});c.opacity||(c.opacity=a.getOpacity());return c};
Effect.Methods={morph:function(a,b,c){a=$(a);new Effect.Morph(a,Object.extend({style:b},c||{}));return a},visualEffect:function(a,b,c){a=$(a);b=b.dasherize().camelize();b=b.charAt(0).toUpperCase()+b.substring(1);new Effect[b](a,c);return a},highlight:function(a,b){a=$(a);new Effect.Highlight(a,b);return a}};
$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(b,c){b=$(b);Effect[a.charAt(0).toUpperCase()+a.substring(1)](b,c);return b}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);
if(Object.isUndefined(Effect))throw"dragdrop.js requires including script.aculo.us' effects.js library";
var Droppables={drops:[],remove:function(a){this.drops=this.drops.reject(function(b){return b.element==$(a)})},add:function(a,b){var a=$(a),c=Object.extend({greedy:!0,hoverclass:null,tree:!1},b||{});if(c.containment){c._containers=[];var d=c.containment;Object.isArray(d)?d.each(function(a){c._containers.push($(a))}):c._containers.push($(d))}c.accept&&(c.accept=[c.accept].flatten());Element.makePositioned(a);c.element=a;this.drops.push(c)},findDeepestChild:function(a){deepest=a[0];for(i=1;i<a.length;++i)Element.isParent(a[i].element,
deepest.element)&&(deepest=a[i]);return deepest},isContained:function(a,b){var c;c=b.tree?a.treeNode:a.parentNode;return b._containers.detect(function(a){return c==a})},isAffected:function(a,b,c){return c.element!=b&&(!c._containers||this.isContained(b,c))&&(!c.accept||Element.classNames(b).detect(function(a){return c.accept.include(a)}))&&Position.within(c.element,a[0],a[1])},deactivate:function(a){a.hoverclass&&Element.removeClassName(a.element,a.hoverclass);this.last_active=null},activate:function(a){a.hoverclass&&
Element.addClassName(a.element,a.hoverclass);this.last_active=a},show:function(a,b){if(this.drops.length){var c,d=[];this.drops.each(function(c){Droppables.isAffected(a,b,c)&&d.push(c)});0<d.length&&(c=Droppables.findDeepestChild(d));this.last_active&&this.last_active!=c&&this.deactivate(this.last_active);if(c){Position.within(c.element,a[0],a[1]);if(c.onHover)c.onHover(b,c.element,Position.overlap(c.overlap,c.element));c!=this.last_active&&Droppables.activate(c)}}},fire:function(a,b){if(this.last_active&&
(Position.prepare(),this.isAffected([Event.pointerX(a),Event.pointerY(a)],b,this.last_active)&&this.last_active.onDrop))return this.last_active.onDrop(b,this.last_active.element,a),!0},reset:function(){this.last_active&&this.deactivate(this.last_active)}},Draggables={drags:[],observers:[],register:function(a){0==this.drags.length&&(this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.updateDrag.bindAsEventListener(this),this.eventKeypress=this.keyPress.bindAsEventListener(this),
Event.observe(document,"mouseup",this.eventMouseUp),Event.observe(document,"mousemove",this.eventMouseMove),Event.observe(document,"keypress",this.eventKeypress));this.drags.push(a)},unregister:function(a){this.drags=this.drags.reject(function(b){return b==a});0==this.drags.length&&(Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"keypress",this.eventKeypress))},activate:function(a){a.options.delay?
this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=a}.bind(this),a.options.delay):(window.focus(),this.activeDraggable=a)},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(this.activeDraggable){var b=[Event.pointerX(a),Event.pointerY(a)];this._lastPointer&&this._lastPointer.inspect()==b.inspect()||(this._lastPointer=b,this.activeDraggable.updateDrag(a,b))}},endDrag:function(a){this._timeout&&(clearTimeout(this._timeout),
this._timeout=null);this.activeDraggable&&(this._lastPointer=null,this.activeDraggable.endDrag(a),this.activeDraggable=null)},keyPress:function(a){this.activeDraggable&&this.activeDraggable.keyPress(a)},addObserver:function(a){this.observers.push(a);this._cacheObserverCallbacks()},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b.element==a});this._cacheObserverCallbacks()},notify:function(a,b,c){0<this[a+"Count"]&&this.observers.each(function(d){if(d[a])d[a](a,
b,c)});if(b.options[a])b.options[a](b,c)},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(a){Draggables[a+"Count"]=Draggables.observers.select(function(b){return b[a]}).length})}},Draggable=Class.create({initialize:function(a,b){var c={handle:!1,reverteffect:function(a,b,c){var g=0.02*Math.sqrt(Math.abs(b^2)+Math.abs(c^2));new Effect.Move(a,{x:-c,y:-b,duration:g,queue:{scope:"_draggable",position:"end"}})},endeffect:function(a){var b=Object.isNumber(a._opacity)?a._opacity:
1;new Effect.Opacity(a,{duration:0.2,from:0.7,to:b,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[a]=!1}})},zindex:1E3,revert:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,snap:!1,delay:0};(!b||Object.isUndefined(b.endeffect))&&Object.extend(c,{starteffect:function(a){a._opacity=Element.getOpacity(a);Draggable._dragging[a]=!0;new Effect.Opacity(a,{duration:0.2,from:a._opacity,to:0.7})}});c=Object.extend(c,b||{});this.element=$(a);c.handle&&Object.isString(c.handle)&&
(this.handle=this.element.down("."+c.handle,0));this.handle||(this.handle=$(c.handle));this.handle||(this.handle=this.element);c.scroll&&(!c.scroll.scrollTo&&!c.scroll.outerHTML)&&(c.scroll=$(c.scroll),this._isScrollChild=Element.childOf(this.element,c.scroll));Element.makePositioned(this.element);this.options=c;this.dragging=!1;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,
"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return[parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]},initDrag:function(a){if(Object.isUndefined(Draggable._dragging[this.element])||!Draggable._dragging[this.element])if(Event.isLeftClick(a)&&(!(tag_name=Event.element(a).tagName.toUpperCase())||!("INPUT"==tag_name||"SELECT"==tag_name||"OPTION"==tag_name||"BUTTON"==tag_name||"TEXTAREA"==tag_name))){var b=
[Event.pointerX(a),Event.pointerY(a)],c=this.element.cumulativeOffset();this.offset=[0,1].map(function(a){return b[a]-c[a]});Draggables.activate(this);Event.stop(a)}},startDrag:function(a){this.dragging=!0;this.delta||(this.delta=this.currentDelta());this.options.zindex&&(this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0),this.element.style.zIndex=this.options.zindex);this.options.ghosting&&(this._clone=this.element.cloneNode(!0),(this._originallyAbsolute="absolute"==this.element.getStyle("position"))||
Position.absolutize(this.element),this.element.parentNode.insertBefore(this._clone,this.element));if(this.options.scroll)if(this.options.scroll==window){var b=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=b.left;this.originalScrollTop=b.top}else this.originalScrollLeft=this.options.scroll.scrollLeft,this.originalScrollTop=this.options.scroll.scrollTop;Draggables.notify("onStart",this,a);this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(a,b){this.dragging||
this.startDrag(a);this.options.quiet||(Position.prepare(),Droppables.show(b,this.element));Draggables.notify("onDrag",this,a);this.draw(b);this.options.change&&this.options.change(this);if(this.options.scroll){this.stopScrolling();var c;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))c=[left,top,left+width,top+height];else c=Position.page(this.options.scroll).toArray(),c[0]+=this.options.scroll.scrollLeft+Position.deltaX,c[1]+=this.options.scroll.scrollTop+Position.deltaY,
c.push(c[0]+this.options.scroll.offsetWidth),c.push(c[1]+this.options.scroll.offsetHeight);var d=[0,0];b[0]<c[0]+this.options.scrollSensitivity&&(d[0]=b[0]-(c[0]+this.options.scrollSensitivity));b[1]<c[1]+this.options.scrollSensitivity&&(d[1]=b[1]-(c[1]+this.options.scrollSensitivity));b[0]>c[2]-this.options.scrollSensitivity&&(d[0]=b[0]-(c[2]-this.options.scrollSensitivity));b[1]>c[3]-this.options.scrollSensitivity&&(d[1]=b[1]-(c[3]-this.options.scrollSensitivity));this.startScrolling(d)}Prototype.Browser.WebKit&&
window.scrollBy(0,0);Event.stop(a)},finishDrag:function(a,b){this.dragging=!1;if(this.options.quiet){Position.prepare();var c=[Event.pointerX(a),Event.pointerY(a)];Droppables.show(c,this.element)}this.options.ghosting&&(this._originallyAbsolute||Position.relativize(this.element),delete this._originallyAbsolute,Element.remove(this._clone),this._clone=null);c=!1;b&&((c=Droppables.fire(a,this.element))||(c=!1));if(c&&this.options.onDropped)this.options.onDropped(this.element);Draggables.notify("onEnd",
this,a);var d=this.options.revert;d&&Object.isFunction(d)&&(d=d(this.element));var e=this.currentDelta();d&&this.options.reverteffect?(0==c||"failure"!=d)&&this.options.reverteffect(this.element,e[1]-this.delta[1],e[0]-this.delta[0]):this.delta=e;this.options.zindex&&(this.element.style.zIndex=this.originalZ);this.options.endeffect&&this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset()},keyPress:function(a){a.keyCode==Event.KEY_ESC&&(this.finishDrag(a,!1),Event.stop(a))},
endDrag:function(a){this.dragging&&(this.stopScrolling(),this.finishDrag(a,!0),Event.stop(a))},draw:function(a){var b=this.element.cumulativeOffset();if(this.options.ghosting){var c=Position.realOffset(this.element);b[0]+=c[0]-Position.deltaX;b[1]+=c[1]-Position.deltaY}c=this.currentDelta();b[0]-=c[0];b[1]-=c[1];this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)&&(b[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft,b[1]-=this.options.scroll.scrollTop-this.originalScrollTop);
c=[0,1].map(function(c){return a[c]-b[c]-this.offset[c]}.bind(this));this.options.snap&&(c=Object.isFunction(this.options.snap)?this.options.snap(c[0],c[1],this):Object.isArray(this.options.snap)?c.map(function(a,b){return(a/this.options.snap[b]).round()*this.options.snap[b]}.bind(this)):c.map(function(a){return(a/this.options.snap).round()*this.options.snap}.bind(this)));var d=this.element.style;if(!this.options.constraint||"horizontal"==this.options.constraint)d.left=c[0]+"px";if(!this.options.constraint||
"vertical"==this.options.constraint)d.top=c[1]+"px";"hidden"==d.visibility&&(d.visibility="")},stopScrolling:function(){this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null,Draggables._lastScrollPointer=null)},startScrolling:function(a){if(a[0]||a[1])this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed],this.lastScrolled=new Date,this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var a=new Date,b=a-this.lastScrolled;
this.lastScrolled=a;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1])a=b/1E3,this.options.scroll.scrollTo(left+a*this.scrollSpeed[0],top+a*this.scrollSpeed[1])}else this.options.scroll.scrollLeft+=this.scrollSpeed[0]*b/1E3,this.options.scroll.scrollTop+=this.scrollSpeed[1]*b/1E3;Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);this._isScrollChild&&(Draggables._lastScrollPointer=
Draggables._lastScrollPointer||$A(Draggables._lastPointer),Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*b/1E3,Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*b/1E3,0>Draggables._lastScrollPointer[0]&&(Draggables._lastScrollPointer[0]=0),0>Draggables._lastScrollPointer[1]&&(Draggables._lastScrollPointer[1]=0),this.draw(Draggables._lastScrollPointer));this.options.change&&this.options.change(this)},_getWindowScroll:function(a){var b,c,d;with(a.document)a.document.documentElement&&documentElement.scrollTop?
(b=documentElement.scrollTop,c=documentElement.scrollLeft):a.document.body&&(b=body.scrollTop,c=body.scrollLeft),a.innerWidth?(d=a.innerWidth,a=a.innerHeight):a.document.documentElement&&documentElement.clientWidth?(d=documentElement.clientWidth,a=documentElement.clientHeight):(d=body.offsetWidth,a=body.offsetHeight);return{top:b,left:c,width:d,height:a}}});Draggable._dragging={};
var SortableObserver=Class.create({initialize:function(a,b){this.element=$(a);this.observer=b;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();this.lastValue!=Sortable.serialize(this.element)&&this.observer(this.element)}}),Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(a){for(;"BODY"!=a.tagName.toUpperCase();){if(a.id&&Sortable.sortables[a.id])return a;
a=a.parentNode}},options:function(a){if(a=Sortable._findRootElement($(a)))return Sortable.sortables[a.id]},destroy:function(a){a=$(a);if(a=Sortable.sortables[a.id])Draggables.removeObserver(a.element),a.droppables.each(function(a){Droppables.remove(a)}),a.draggables.invoke("destroy"),delete Sortable.sortables[a.element.id]},create:function(a,b){var a=$(a),c=Object.extend({element:a,tag:"li",dropOnEmpty:!1,tree:!1,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:a,handle:!1,only:!1,
delay:0,hoverclass:null,ghosting:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:!1,handles:!1,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},b||{});this.destroy(a);var d={revert:!0,quiet:c.quiet,scroll:c.scroll,scrollSpeed:c.scrollSpeed,scrollSensitivity:c.scrollSensitivity,delay:c.delay,ghosting:c.ghosting,constraint:c.constraint,handle:c.handle};c.starteffect&&(d.starteffect=c.starteffect);c.reverteffect?d.reverteffect=c.reverteffect:
c.ghosting&&(d.reverteffect=function(a){a.style.top=0;a.style.left=0});c.endeffect&&(d.endeffect=c.endeffect);c.zindex&&(d.zindex=c.zindex);var e={overlap:c.overlap,containment:c.containment,tree:c.tree,hoverclass:c.hoverclass,onHover:Sortable.onHover},f={onHover:Sortable.onEmptyHover,overlap:c.overlap,containment:c.containment,hoverclass:c.hoverclass};Element.cleanWhitespace(a);c.draggables=[];c.droppables=[];if(c.dropOnEmpty||c.tree)Droppables.add(a,f),c.droppables.push(a);(c.elements||this.findElements(a,
c)||[]).each(function(b,f){var l=c.handles?$(c.handles[f]):c.handle?$(b).select("."+c.handle)[0]:b;c.draggables.push(new Draggable(b,Object.extend(d,{handle:l})));Droppables.add(b,e);c.tree&&(b.treeNode=a);c.droppables.push(b)});c.tree&&(Sortable.findTreeElements(a,c)||[]).each(function(b){Droppables.add(b,f);b.treeNode=a;c.droppables.push(b)});this.sortables[a.identify()]=c;Draggables.addObserver(new SortableObserver(a,c.onUpdate))},findElements:function(a,b){return Element.findChildren(a,b.only,
b.tree?!0:!1,b.tag)},findTreeElements:function(a,b){return Element.findChildren(a,b.only,b.tree?!0:!1,b.treeTag)},onHover:function(a,b,c){if(!Element.isParent(b,a)&&!(0.33<c&&0.66>c&&Sortable.options(b).tree))if(0.5<c){if(Sortable.mark(b,"before"),b.previousSibling!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,b);if(b.parentNode!=c)Sortable.options(c).onChange(a);Sortable.options(b.parentNode).onChange(a)}}else{Sortable.mark(b,"after");var d=b.nextSibling||null;if(d!=
a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,d);if(b.parentNode!=c)Sortable.options(c).onChange(a);Sortable.options(b.parentNode).onChange(a)}}},onEmptyHover:function(a,b,c){var d=a.parentNode,e=Sortable.options(b);if(!Element.isParent(b,a)){var f=Sortable.findElements(b,{tag:e.tag,only:e.only}),g=null;if(f)for(var h=Element.offsetSize(b,e.overlap)*(1-c),c=0;c<f.length;c+=1)if(0<=h-Element.offsetSize(f[c],e.overlap))h-=Element.offsetSize(f[c],e.overlap);else{g=0<=h-Element.offsetSize(f[c],
e.overlap)/2?c+1<f.length?f[c+1]:null:f[c];break}b.insertBefore(a,g);Sortable.options(d).onChange(a);e.onChange(a)}},unmark:function(){Sortable._marker&&Sortable._marker.hide()},mark:function(a,b){var c=Sortable.options(a.parentNode);if(!c||c.ghosting){Sortable._marker||(Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"}),document.getElementsByTagName("body").item(0).appendChild(Sortable._marker));var d=
a.cumulativeOffset();Sortable._marker.setStyle({left:d[0]+"px",top:d[1]+"px"});"after"==b&&("horizontal"==c.overlap?Sortable._marker.setStyle({left:d[0]+a.clientWidth+"px"}):Sortable._marker.setStyle({top:d[1]+a.clientHeight+"px"}));Sortable._marker.show()}},_tree:function(a,b,c){for(var d=Sortable.findElements(a,b)||[],e=0;e<d.length;++e){var f=d[e].id.match(b.format);f&&(f={id:encodeURIComponent(f?f[1]:null),element:a,parent:c,children:[],position:c.children.length,container:$(d[e]).down(b.treeTag)},
f.container&&this._tree(f.container,b,f),c.children.push(f))}return c},tree:function(a,b){var a=$(a),c=this.options(a),c=Object.extend({tag:c.tag,treeTag:c.treeTag,only:c.only,name:a.id,format:c.format},b||{});return Sortable._tree(a,c,{id:null,parent:null,children:[],container:a,position:0})},_constructIndex:function(a){var b="";do a.id&&(b="["+a.position+"]"+b);while(null!=(a=a.parent));return b},sequence:function(a,b){var a=$(a),c=Object.extend(this.options(a),b||{});return $(this.findElements(a,
c)||[]).map(function(a){return a.id.match(c.format)?a.id.match(c.format)[1]:""})},setSequence:function(a,b,c){var a=$(a),d=Object.extend(this.options(a),c||{}),e={};this.findElements(a,d).each(function(a){a.id.match(d.format)&&(e[a.id.match(d.format)[1]]=[a,a.parentNode]);a.parentNode.removeChild(a)});b.each(function(a){var b=e[a];b&&(b[1].appendChild(b[0]),delete e[a])})},serialize:function(a,b){var a=$(a),c=Object.extend(Sortable.options(a),b||{}),d=encodeURIComponent(b&&b.name?b.name:a.id);return c.tree?
Sortable.tree(a,b).children.map(function(a){return[d+Sortable._constructIndex(a)+"[id]="+encodeURIComponent(a.id)].concat(a.children.map(arguments.callee))}).flatten().join("&"):Sortable.sequence(a,b).map(function(a){return d+"[]="+encodeURIComponent(a)}).join("&")}};Element.isParent=function(a,b){return!a.parentNode||a==b?!1:a.parentNode==b?!0:Element.isParent(a.parentNode,b)};
Element.findChildren=function(a,b,c,d){if(!a.hasChildNodes())return null;d=d.toUpperCase();b&&(b=[b].flatten());var e=[];$A(a.childNodes).each(function(a){a.tagName&&(a.tagName.toUpperCase()==d&&(!b||Element.classNames(a).detect(function(a){return b.include(a)})))&&e.push(a);c&&(a=Element.findChildren(a,b,c,d))&&e.push(a)});return 0<e.length?e.flatten():[]};Element.offsetSize=function(a,b){return a["offset"+("vertical"==b||"height"==b?"Height":"Width")]};
Droppables.fire=function(a,b){if(this.last_active){Position.prepare();var c=a.touches?Draggables._lastPointer:[Event.pointerX(a),Event.pointerY(a)];if(this.isAffected(c,b,this.last_active)&&this.last_active.onDrop)return this.last_active.onDrop(b,this.last_active.element,a),!0}};
Draggables.register=function(a){0==this.drags.length&&(this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.updateDrag.bindAsEventListener(this),this.eventKeypress=this.keyPress.bindAsEventListener(this),Event.observe(document,"mouseup",this.eventMouseUp),Event.observe(document,"mousemove",this.eventMouseMove),Event.observe(document,"keypress",this.eventKeypress),Event.observe(document,"touchstart",this.eventKeypress),Event.observe(document,"touchmove",this.eventMouseMove),
Event.observe(document,"touchend",this.eventMouseUp));this.drags.push(a)};
Draggables.unregister=function(a){this.drags=this.drags.reject(function(b){return b==a});0==this.drags.length&&(Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"keypress",this.eventKeypress),Event.stopObserving(document,"touchstart",this.eventKeypress),Event.stopObserving(document,"touchmove",this.eventMouseMove),Event.stopObserving(document,"touchend",this.eventMouseUp))};
Draggables.updateDrag=function(a){if(this.activeDraggable){var b=[Event.pointerX(a),Event.pointerY(a)];this._lastPointer&&this._lastPointer.inspect()==b.inspect()||(this._lastPointer=b,this.activeDraggable.updateDrag(a,b))}};Draggables.endDrag=function(a){this._timeout&&(clearTimeout(this._timeout),this._timeout=null);this.activeDraggable&&(this.activeDraggable.endDrag(a),this.activeDraggable=null)};
Draggable.addMethods({initialize:function(a,b){var c={handle:!1,reverteffect:function(a,b,c){var g=0.02*Math.sqrt(Math.abs(b^2)+Math.abs(c^2));new Effect.Move(a,{x:-c,y:-b,duration:g,queue:{scope:"_draggable",position:"end"}})},endeffect:function(a){var b=Object.isNumber(a._opacity)?a._opacity:1;new Effect.Opacity(a,{duration:0.2,from:0.7,to:b,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[a]=!1}})},zindex:1E3,revert:!1,quiet:!1,scroll:!1,scrollSensitivity:20,
scrollSpeed:15,snap:!1,delay:0};(!b||Object.isUndefined(b.endeffect))&&Object.extend(c,{starteffect:function(a){a._opacity=Element.getOpacity(a);Draggable._dragging[a]=!0;new Effect.Opacity(a,{duration:0.2,from:a._opacity,to:0.7})}});c=Object.extend(c,b||{});this.element=$(a);c.handle&&Object.isString(c.handle)&&(this.handle=this.element.down("."+c.handle,0));this.handle||(this.handle=$(c.handle));this.handle||(this.handle=this.element);c.scroll&&(!c.scroll.scrollTo&&!c.scroll.outerHTML)&&(c.scroll=
$(c.scroll),this._isScrollChild=Element.childOf(this.element,c.scroll));Element.makePositioned(this.element);this.options=c;this.dragging=!1;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Event.observe(this.handle,"touchstart",this.eventMouseDown);Draggables.register(this)}});
Draggable.destroy=function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Event.stopObserving(this.handle,"touchstart",this.eventMouseDown);Draggables.unregister(this)};
Draggable.finishDrag=function(a,b){this.dragging=!1;if(this.options.quiet){Position.prepare();var c=[Event.pointerX(a),Event.pointerY(a)];Droppables.show(c,this.element)}this.options.ghosting&&(this._originallyAbsolute||Position.relativize(this.element),delete this._originallyAbsolute,Element.remove(this._clone),this._clone=null);c=!1;b&&((c=Droppables.fire(a,this.element))?Draggables._lastPointer=null:c=!1);if(c&&this.options.onDropped)this.options.onDropped(this.element);Draggables.notify("onEnd",
this,a);var d=this.options.revert;d&&Object.isFunction(d)&&(d=d(this.element));var e=this.currentDelta();d&&this.options.reverteffect?(0==c||"failure"!=d)&&this.options.reverteffect(this.element,e[1]-this.delta[1],e[0]-this.delta[0]):this.delta=e;this.options.zindex&&(this.element.style.zIndex=this.originalZ);this.options.endeffect&&this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset()};
if("undefined"==typeof Effect)throw"lightwindow.js requires including script.aculo.us' effects.js library!";try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e$$22){}var lightwindow=Class.create();
lightwindow.prototype={element:null,contentToFetch:null,windowActive:!1,dataEffects:[],dimensions:{cruft:null,container:null,viewport:{height:null,width:null,offsetTop:null,offsetLeft:null}},pagePosition:{x:0,y:0},pageDimensions:{width:null,height:null},preloadImage:[],preloadedImage:[],galleries:[],resizeTo:{height:null,heightPercent:null,width:null,widthPercent:null,fixedTop:null,fixedLeft:null},scrollbarOffset:18,navigationObservers:{previous:null,next:null},containerChange:{height:0,width:0},
activeGallery:!1,galleryLocation:{current:0,total:0},initialize:function(a){var b=a&&a.closetext?a.closetext:"Close";a&&(a.fixedTop&&""!=a.fixedTop)&&(this.resizeTo.fixedTop=a.fixedTop,this.dimensions.viewport.offsetTop=a.fixedTop);this.options=Object.extend({resizeSpeed:8,contentOffset:{height:20,width:20},dimensions:{image:{height:250,width:250},page:{height:250,width:250},inline:{height:250,width:250},media:{height:250,width:250},external:{height:250,width:250},titleHeight:25},classNames:{standard:"lightwindow",
action:"lightwindow_action"},fileTypes:{page:"asp aspx cgi cfm htm html pl php4 php3 php php5 phtml rhtml shtml txt vbs rb".split(" "),media:"aif aiff asf avi divx m1v m2a m2v m3u mid midi mov moov movie mp2 mp3 mpa mpa mpe mpeg mpg mpg mpga pps qt rm ram swf viv vivo wav".split(" "),image:["bmp","gif","jpg","png","tiff"]},mimeTypes:{avi:"video/avi",aif:"audio/aiff",aiff:"audio/aiff",gif:"image/gif",bmp:"image/bmp",jpeg:"image/jpeg",m1v:"video/mpeg",m2a:"audio/mpeg",m2v:"video/mpeg",m3u:"audio/x-mpequrl",
mid:"audio/x-midi",midi:"audio/x-midi",mjpg:"video/x-motion-jpeg",moov:"video/quicktime",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg3",mpa:"audio/mpeg",mpa:"video/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"audio/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",pdf:"application/pdf",png:"image/png",pps:"application/mspowerpoint",qt:"video/quicktime",ram:"audio/x-pn-realaudio-plugin",rm:"application/vnd.rn-realmedia",swf:"application/x-shockwave-flash",tiff:"image/tiff",
viv:"video/vivo",vivo:"video/vivo",wav:"audio/wav",wmv:"application/x-mplayer2"},classids:{mov:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",swf:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",wmv:"clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6"},codebases:{mov:"http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0",swf:"http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0",wmv:"http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=6,4,5,715"},
viewportPadding:10,EOLASFix:"swf,wmv,fla,flv",overlay:{opacity:0.7,image:"/w2gi/images/lightwindow/black.png",presetImage:"/w2gi/images/lightwindow/black-70.png"},skin:{main:'<div id="lightwindow_container" ><div id="lightwindow_title_bar" ><div id="lightwindow_title_bar_inner" ><span id="lightwindow_title_bar_title"></span><a id="lightwindow_title_bar_close_link" >'+b+'</a></div></div><div id="lightwindow_stage" ><div id="lightwindow_contents" ></div><div id="lightwindow_navigation" ><a href="#" id="lightwindow_previous" ><span id="lightwindow_previous_title"></span></a><a href="#" id="lightwindow_next" ><span id="lightwindow_next_title"></span></a><iframe name="lightwindow_navigation_shim" id="lightwindow_navigation_shim" src="javascript:false;" frameBorder="0" scrolling="no"></iframe></div><div id="lightwindow_galleries"><div id="lightwindow_galleries_tab_container" ><a href="#" id="lightwindow_galleries_tab" ><span id="lightwindow_galleries_tab_span" class="up" >Galleries</span></a></div><div id="lightwindow_galleries_list" ></div></div></div><div id="lightwindow_data_slide" ><div id="lightwindow_data_slide_inner" ><div id="lightwindow_data_details" ><div id="lightwindow_data_gallery_container" ><span id="lightwindow_data_gallery_current"></span> of <span id="lightwindow_data_gallery_total"></span></div><div id="lightwindow_data_author_container" >by <span id="lightwindow_data_author"></span></div></div><div id="lightwindow_data_caption" ></div></div></div></div>',
loading:'<div id="lightwindow_loading" ><img src="/w2gi/images/lightwindow/ajax-loading.gif" alt="loading" /><span>Loading or <a href="javascript: myLightWindow.deactivate();">Cancel</a></span><iframe name="lightwindow_loading_shim" id="lightwindow_loading_shim" src="javascript:false;" frameBorder="0" scrolling="no"></iframe></div>',iframe:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><body>{body_replace}</body></html>',
gallery:{top:'<div class="lightwindow_galleries_list"><h1>{gallery_title_replace}</h1><ul>',middle:"<li>{gallery_link_replace}</li>",bottom:"</ul></div>"}},formMethod:"get",hideFlash:!1,hideGalleryTab:!1,showTitleBar:!0,animationHandler:!1,navigationHandler:!1,transitionHandler:!1,finalAnimationHandler:!1,formHandler:!1,galleryAnimationHandler:!1,showGalleryCount:!0},a||{});this.duration=0.3;("undefined"==typeof a||!a.noListeners)&&this._setupLinks();this._getScroll();this._getPageDimensions();this._browserDimensions();
this._addLightWindowMarkup(!1);this._setupDimensions();this.buildGalleryList()},activate:function(a,b){this._clearWindowContents(!0);this._addLoadingWindowMarkup();this._setupWindowElements(b);this._getScroll();this._browserDimensions();this._setupDimensions();this._toggleTroubleElements("hidden",!1);this._displayLightWindow("block","hidden");this._setStatus(!0);this._monitorKeyboard(!0);this._prepareIE(!0);this._loadWindow()},deactivate:function(){this.activeGallery=this.windowActive=!1;this.options.hideGalleryTab||
this._handleGalleryAnimation(!1);this.animating=!1;this.element=null;this._displayLightWindow("none","visible");this._clearWindowContents(!1);this._prepareIE(!1);this._setupDimensions();this._toggleTroubleElements("visible",!1);this._monitorKeyboard(!1);document.fire("lightwindow:closed")},createWindow:function(a){this._processLink($(a))},activateWindow:function(a){this.element=Object.extend({href:null,title:null,author:null,caption:null,rel:null,top:null,left:null,type:null,showImages:null,height:null,
width:null,loadingAnimation:null,openAnimation:null,modalOverlay:!1,iframeEmbed:null,form:null,params:null},a||{});this.contentToFetch=this.element.href;this.windowType=this.element.type?this.element.type:this._fileType(this.element.href);this._clearWindowContents(!0);this.element.hideLoadingHTML||this._addLoadingWindowMarkup();this._getScroll();this._browserDimensions();this._setupDimensions();this._toggleTroubleElements("hidden",!1);this._displayLightWindow("block","hidden");this._setStatus(!0);
this._monitorKeyboard(!0);this._prepareIE(!0);this._loadWindow()},submitForm:function(a){this.options.formHandler?this.options.formHandler(a):this._defaultFormHandler(a)},openWindow:function(a){a=$(a);this.windowActive=!0;this._clearWindowContents(!0);this._addLoadingWindowMarkup();this._setupWindowElements(a);this._setStatus(!0);this._handleTransition()},navigateWindow:function(a){this._handleNavigation(!1);"previous"==a?this.openWindow(this.navigationObservers.previous):"next"==a&&this.openWindow(this.navigationObservers.next)},
buildGalleryList:function(){var a="",b;for(i in this.galleries)if("object"==typeof this.galleries[i]){a+=this.options.skin.gallery.top.replace("{gallery_title_replace}",unescape(i));for(j in this.galleries[i])"object"==typeof this.galleries[i][j]&&(b='<a href="#" id="lightwindow_gallery_'+i+"_"+j+'" >'+unescape(j)+"</a>",a+=this.options.skin.gallery.middle.replace("{gallery_link_replace}",b));a+=this.options.skin.gallery.bottom}new Insertion.Top("lightwindow_galleries_list",a);for(i in this.galleries)if("object"==
typeof this.galleries[i])for(j in this.galleries[i])"object"==typeof this.galleries[i][j]&&(Event.observe($("lightwindow_gallery_"+i+"_"+j),"click",this.openWindow.bind(this,this.galleries[i][j][0]),!1),$("lightwindow_gallery_"+i+"_"+j).onclick=function(){return!1})},_setupLinks:function(){var a=$$("."+this.options.classNames.standard);a&&0<a.length&&a.each(function(a){this._processLink(a)}.bind(this))},_processLink:function(a){if("image"==this._fileType(a.getAttribute("href"))||"media"==this._fileType(a.getAttribute("href")))if(gallery=
this._getGalleryInfo(a.rel))this.galleries[gallery[0]]||(this.galleries[gallery[0]]=[]),this.galleries[gallery[0]][gallery[1]]||(this.galleries[gallery[0]][gallery[1]]=[]),this.galleries[gallery[0]][gallery[1]].push(a);var b=a.href&&""!=a.href?a.href:a.readAttribute("href");b||(b=a.readAttribute("url"));-1<b.indexOf("?")&&(b=b.substring(0,b.indexOf("?")));b=b.substring(b.indexOf("#")+1);$(b)&&$(b).setStyle({display:"none"});Event.observe(a,"click",this.activate.bindAsEventListener(this,a),!1);a.onclick=
function(){return!1}},_setupActions:function(){$$("#lightwindow_container ."+this.options.classNames.action)},_addLightWindowMarkup:function(){var a=Element.extend(document.createElement("div"));a.setAttribute("id","lightwindow_overlay");Prototype.Browser.Gecko?a.setStyle({backgroundImage:"url("+this.options.overlay.presetImage+")",backgroundRepeat:"repeat",position:"fixed",height:this.pageDimensions.height+"px"}):a.setStyle({opacity:this.options.overlay.opacity,backgroundImage:"url("+this.options.overlay.image+
")",backgroundRepeat:"repeat",position:"fixed",height:this.pageDimensions.height+"px"});var b=document.createElement("div");b.setAttribute("id","lightwindow");b.innerHTML=this.options.skin.main;var c=document.getElementsByTagName("body")[0],d=$("lightwindow_overlay"),e=$("lightwindow");d&&e?(a=d,b=e):(c.appendChild(a),c.appendChild(b));$("lightwindow_title_bar_close_link")&&(Event.observe("lightwindow_title_bar_close_link","click",this.deactivate.bindAsEventListener(this)),$("lightwindow_title_bar_close_link").onclick=
function(){return!1});Event.observe($("lightwindow_previous"),"click",this.navigateWindow.bind(this,"previous"),!1);$("lightwindow_previous").onclick=function(){return!1};Event.observe($("lightwindow_next"),"click",this.navigateWindow.bind(this,"next"),!1);$("lightwindow_next").onclick=function(){return!1};this.options.hideGalleryTab||(Event.observe($("lightwindow_galleries_tab"),"click",this._handleGalleryAnimation.bind(this,!0),!1),$("lightwindow_galleries_tab").onclick=function(){return!1});Event.observe(a,
"click",function(){var a=this._getParameter("lightwindow_modal_overlay");(!a||"true"!=a.toLowerCase())&&this.deactivate()}.bindAsEventListener(this),!1);a.onclick=function(){return!1}},_addLoadingWindowMarkup:function(){$("lightwindow_contents").innerHTML+=this.options.skin.loading},_setupWindowElements:function(a){this.element=a;this.element.title=a.getAttribute("title");this.element.author=a.getAttribute("author");this.element.caption=a.getAttribute("caption");this.element.rel=a.getAttribute("rel");
this.element.params=a.getAttribute("params");this.contentToFetch=this.element.url&&""!=this.element.url?this.element.url:this.element.readAttribute("url");this.windowType=this._getParameter("lightwindow_type")?this._getParameter("lightwindow_type"):this._fileType(this.contentToFetch)},_clearWindowContents:function(a){$("lightwindow_iframe")&&Element.remove($("lightwindow_iframe"));if($("lightwindow_media_primary")){try{$("lightwindow_media_primary").Stop()}catch(b){}Element.remove($("lightwindow_media_primary"))}if($("lightwindow_media_secondary")){try{$("lightwindow_media_secondary").Stop()}catch(c){}Element.remove($("lightwindow_media_secondary"))}this.activeGallery=
!1;this._handleNavigation(this.activeGallery);a&&($("lightwindow_contents").innerHTML="",$("lightwindow_contents").setStyle({overflow:"auto"}),this.windowActive||($("lightwindow_data_slide_inner").setStyle({display:"none"}),$("lightwindow_title_bar_title").innerHTML=""),$("lightwindow_data_slide").setStyle({height:"auto"}));this.resizeTo.height=null;this.resizeTo.width=null},_setStatus:function(a){(this.animating=a)&&$("lightwindow_loading")&&Element.show("lightwindow_loading");/MSIE 6./i.test(navigator.userAgent)||
this._fixedWindow(a)},_fixedWindow:function(a){$("lightwindow_overlay").setStyle({position:"fixed"});a?this._getScroll():this.windowActive?this._getScroll():$("lightwindow_iframe")&&this._browserDimensions();$("lightwindow").setStyle({position:"fixed",top:"50%",left:"50%"})},_prepareIE:function(a){if(Prototype.Browser.IE){var a=a?"100%":"auto",b=document.getElementsByTagName("body")[0];document.getElementsByTagName("html")[0].style.height=b.style.height=a}},_stopScrolling:function(a){this.animating&&
(a.preventDefault&&a.preventDefault(),a.returnValue=!1)},_getScroll:function(){"number"==typeof window.pageYOffset?(this.pagePosition.x=window.pageXOffset,this.pagePosition.y=window.pageYOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(this.pagePosition.x=document.body.scrollLeft,this.pagePosition.y=document.body.scrollTop):document.documentElement&&(this.pagePosition.x=document.documentElement.scrollLeft,this.pagePosition.y=document.documentElement.scrollTop)},_setScroll:function(a,
b){document.documentElement.scrollLeft=a;document.documentElement.scrollTop=b},_toggleTroubleElements:function(a,b){for(var c=b?$("lightwindow_contents").getElementsByTagName("select"):document.getElementsByTagName("select"),d=0;d<c.length;d++)c[d].style.visibility=a;if(!b){if(this.options.hideFlash){c=document.getElementsByTagName("object");for(d=0;d!=c.length;d++)c[d].style.visibility=a;c=document.getElementsByTagName("embed");for(d=0;d!=c.length;d++)c[d].style.visibility=a}c=document.getElementsByTagName("iframe");
for(d=0;d!=c.length;d++)c[d].style.visibility=a}},_getPageDimensions:function(){var a,b;window.innerHeight&&window.scrollMaxY?(a=document.body.scrollWidth,b=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(a=document.body.scrollWidth,b=document.body.scrollHeight):(a=document.body.offsetWidth,b=document.body.offsetHeight);var c,d;self.innerHeight?(c=self.innerWidth,d=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(c=document.documentElement.clientWidth,
d=document.documentElement.clientHeight):document.body&&(c=document.body.clientWidth,d=document.body.clientHeight);this.pageDimensions.height=b<d?d:b;this.pageDimensions.width=a<c?c:a},_displayLightWindow:function(a,b){$("lightwindow_overlay").style.display=$("lightwindow").style.display=$("lightwindow_container").style.display=a;$("lightwindow_overlay").style.visibility=$("lightwindow").style.visibility=$("lightwindow_container").style.visibility=b},_setupDimensions:function(){var a,b;switch(this.windowType){case "page":a=
this.options.dimensions.page.height;b=this.options.dimensions.page.width;break;case "image":a=this.options.dimensions.image.height;b=this.options.dimensions.image.width;break;case "media":a=this.options.dimensions.media.height;b=this.options.dimensions.media.width;break;case "external":a=this.options.dimensions.external.height;b=this.options.dimensions.external.width;break;case "inline":a=this.options.dimensions.inline.height;b=this.options.dimensions.inline.width;break;default:a=this.options.dimensions.page.height,
b=this.options.dimensions.page.width}var c=this._getParameter("lightwindow_top")?parseFloat(this._getParameter("lightwindow_top"))+this.pagePosition.y:this.dimensions.viewport.height/2+this.pagePosition.y,d=this._getParameter("lightwindow_left")?parseFloat(this._getParameter("lightwindow_left"))+this.pagePosition.x:this.dimensions.viewport.width/2+this.pagePosition.x;$("lightwindow").setStyle({top:c+"px",left:d+"px"});$("lightwindow_container").setStyle({height:a+"px",width:b+"px",left:-(b/2)+"px",
top:-(a/2)+"px"});$("lightwindow_contents").setStyle({height:a+"px",width:b+"px"})},_fileType:function(a){if(!a)return"external";if(RegExp("[^.].("+this.options.fileTypes.image.join("|")+")s*$","i").test(a))return"image";if(-1<a.indexOf("#")&&document.domain==this._getDomain(a))return"inline";-1<a.indexOf("?")&&(a=a.substring(0,a.indexOf("?")));var b="unknown",c=RegExp("[^.].("+this.options.fileTypes.page.join("|")+")s*$","i"),d=RegExp("[^.].("+this.options.fileTypes.media.join("|")+")s*$","i");document.domain!=
this._getDomain(a)&&(b="external");d.test(a)&&(b="media");if("external"==b||"media"==b)return b;if(c.test(a)||"/"==a.substr(a.length-1,a.length))b="page";return b},_fileExtension:function(a){-1<a.indexOf("?")&&(a=a.substring(0,a.indexOf("?")));for(var b="",c=a.length-1;-1<c;c--){if("."==a.charAt(c))return b;b=a.charAt(c)+b}},_monitorKeyboard:function(a){document.onkeydown=a?this._eventKeypress.bind(this):""},_eventKeypress:function(a){a=null==a?event.keyCode:a.which;switch(a){case 27:this.deactivate()}switch(String.fromCharCode(a).toLowerCase()){case "p":this.navigationObservers.previous&&
this.navigateWindow("previous");break;case "n":this.navigationObservers.next&&this.navigateWindow("next")}},_getGalleryInfo:function(a){return!a?!1:-1<a.indexOf("[")?[escape(a.substring(0,a.indexOf("["))),escape(a.substring(a.indexOf("[")+1,a.indexOf("]")))]:!1},_getDomain:function(a){var b=a.indexOf("//")+2,a=a.substring(b,a.length),b=a.indexOf("/"),a=a.substring(0,b);-1<a.indexOf(":")&&(b=a.indexOf(":"),a=a.substring(0,b));return a},_getParameter:function(a,b){if(!this.element)return!1;if("lightwindow_top"==
a&&this.element.top)return unescape(this.element.top);if("lightwindow_left"==a&&this.element.left)return unescape(this.element.left);if("lightwindow_type"==a&&this.element.type)return unescape(this.element.type);if("lightwindow_show_images"==a&&this.element.showImages)return unescape(this.element.showImages);if("lightwindow_height"==a&&this.element.height)return unescape(this.element.height);if("lightwindow_width"==a&&this.element.width)return unescape(this.element.width);if("lightwindow_loading_animation"==
a&&this.element.loadingAnimation)return unescape(this.element.loadingAnimation);if("lightwindow_open_animation"==a&&this.element.openAnimation)return unescape(this.element.openAnimation);if("lightwindow_iframe_embed"==a&&this.element.iframeEmbed)return unescape(this.element.iframeEmbed);if("lightwindow_form"==a&&this.element.form)return unescape(this.element.form);if("lightwindow_modal_overlay"==a&&this.element.modalOverlay)return unescape(this.element.modalOverlay);if(!b)if(this.element.params)b=
this.element.params;else return;for(var c,d=b.split(","),e=a+"=",f=e.length,g=0;g<d.length;g++){var h=d[g];" "==h.charAt(0)&&(h=h.substr(1));h=h.substr(0,f);if(h==e){c=d[g].split("=")[1];break}}return c?unescape(c):null},_browserDimensions:function(){if(Prototype.Browser.IE){var a=1*document.documentElement.clientHeight,b=1*document.documentElement.clientWidth;this.dimensions.viewport.height=0!=a&&void 0!=a&&null!=a?a:document.documentElement.offsetHeight;this.dimensions.viewport.width=0!=b&&void 0!=
b&&null!=b?b:document.documentElement.offsetWidth}else this.dimensions.viewport.height=window.innerHeight,this.dimensions.viewport.width=document.width||document.body.offsetWidth},_getScrollerWidth:function(){var a=Element.extend(document.createElement("div"));a.setAttribute("id","lightwindow_scroll_div");a.setStyle({position:"absolute",top:"-10000px",left:"-10000px",width:"100px",height:"100px",overflow:"auto"});var b=Element.extend(document.createElement("div"));b.setAttribute("id","lightwindow_content_scroll_div");
b.setStyle({width:"100%",height:"200px"});a.appendChild(b);document.getElementsByTagName("body")[0].appendChild(a);b=$("lightwindow_content_scroll_div").offsetWidth;a.style.overflow="auto";a=$("lightwindow_content_scroll_div").offsetWidth;Element.remove($("lightwindow_scroll_div"));this.scrollbarOffset=b-a},_addParamToObject:function(a,b,c,d){var e=document.createElement("param");e.setAttribute("value",b);e.setAttribute("name",a);d&&e.setAttribute("id",d);c.appendChild(e);return c},_outerHTML:function(a){if(Prototype.Browser.IE)return a.outerHTML;
var a=a.cloneNode(!0),b=document.createElement("div");b.appendChild(a);return b.innerHTML},_convertToMarkup:function(a,b){var c=this._outerHTML(a).replace("</"+b+">","");if(Prototype.Browser.IE){for(var d=0;d<a.childNodes.length;d++)c+=this._outerHTML(a.childNodes[d]);c+="</"+b+">"}return c},_appendObject:function(a,b,c){if(Prototype.Browser.IE){if(c.innerHTML+=this._convertToMarkup(a,b),-1<this.options.EOLASFix.indexOf(this._fileType(this.element.href))){a=document.getElementsByTagName("object");
for(b=0;b<a.length;b++)a[b].getAttribute("data")&&a[b].removeAttribute("data"),a[b].outerHTML=a[b].outerHTML,a[b].style.visibility="visible"}}else c.appendChild(a)},_appendIframe:function(a){var b=document.createElement("iframe");b.setAttribute("id","lightwindow_iframe");b.setAttribute("name","lightwindow_iframe");b.setAttribute("src","about:blank");b.setAttribute("height","100%");b.setAttribute("width","100%");b.setAttribute("frameborder","0");b.setAttribute("marginwidth","0");b.setAttribute("marginheight",
"0");b.setAttribute("scrolling",a);this._appendObject(b,"iframe",$("lightwindow_contents"))},_writeToIframe:function(a){var b=this.options.skin.iframe,b=b.replace("{body_replace}",a);$("lightwindow_iframe").contentWindow?($("lightwindow_iframe").contentWindow.document.open(),$("lightwindow_iframe").contentWindow.document.write(b),$("lightwindow_iframe").contentWindow.document.close()):($("lightwindow_iframe").contentDocument.open(),$("lightwindow_iframe").contentDocument.write(b),$("lightwindow_iframe").contentDocument.close())},
_loadWindow:function(){"alert"==this.windowType&&(this.windowType="inline");switch(this.windowType){case "image":var a=0,b=[];this.checkImage=[];this.resizeTo.height=this.resizeTo.width=0;this.imageCount=this._getParameter("lightwindow_show_images")?parseInt(this._getParameter("lightwindow_show_images")):1;if(gallery=this._getGalleryInfo(this.element.rel)){for(a=0;a<this.galleries[gallery[0]][gallery[1]].length&&!(-1<this.contentToFetch.indexOf(this.galleries[gallery[0]][gallery[1]][a].href));a++);
this.navigationObservers.previous=this.galleries[gallery[0]][gallery[1]][a-this.imageCount]?this.galleries[gallery[0]][gallery[1]][a-this.imageCount]:!1;this.navigationObservers.next=this.galleries[gallery[0]][gallery[1]][a+this.imageCount]?this.galleries[gallery[0]][gallery[1]][a+this.imageCount]:!1;this.activeGallery=!0}else this.navigationObservers.previous=!1,this.activeGallery=this.navigationObservers.next=!1;for(var c=a;c<a+this.imageCount;c++){if(gallery&&this.galleries[gallery[0]][gallery[1]][c]){this.contentToFetch=
this.galleries[gallery[0]][gallery[1]][c].href;this.galleryLocation={current:(c+1)/this.imageCount,total:this.galleries[gallery[0]][gallery[1]].length/this.imageCount};if(this.galleries[gallery[0]][gallery[1]][c+this.imageCount]){$("lightwindow_next").setStyle({display:"block"});var d=this.galleries[gallery[0]][gallery[1]][c+this.imageCount].title;$("lightwindow_next_title").innerHTML=d?d:""}else $("lightwindow_next").setStyle({display:"none"});this.galleries[gallery[0]][gallery[1]][c-this.imageCount]?
($("lightwindow_previous").setStyle({display:"block"}),d=this.galleries[gallery[0]][gallery[1]][c-this.imageCount].title,$("lightwindow_previous_title").innerHTML=d?d:""):$("lightwindow_previous").setStyle({display:"none"})}b[c]=document.createElement("img");b[c].setAttribute("id","lightwindow_image_"+c);b[c].setAttribute("border","0");b[c].setAttribute("src",this.contentToFetch);$("lightwindow_contents").appendChild(b[c]);this.checkImage[c]=new PeriodicalExecuter(function(a){if(!("undefined"!=typeof $("lightwindow_image_"+
a).naturalWidth&&0==$("lightwindow_image_"+a).naturalWidth)){this.checkImage[a].stop();var b=$("lightwindow_image_"+a).getHeight();b>this.resizeTo.height&&(this.resizeTo.height=b);this.resizeTo.width+=$("lightwindow_image_"+a).getWidth();this.imageCount--;$("lightwindow_image_"+a).setStyle({height:"100%"});0==this.imageCount&&this._processWindow()}}.bind(this,c),1)}break;case "media":a=0;this.resizeTo.height=this.resizeTo.width=0;if(gallery=this._getGalleryInfo(this.element.rel)){for(a=0;a<this.galleries[gallery[0]][gallery[1]].length&&
!(-1<this.contentToFetch.indexOf(this.galleries[gallery[0]][gallery[1]][a].href));a++);this.navigationObservers.previous=this.galleries[gallery[0]][gallery[1]][a-1]?this.galleries[gallery[0]][gallery[1]][a-1]:!1;this.navigationObservers.next=this.galleries[gallery[0]][gallery[1]][a+1]?this.galleries[gallery[0]][gallery[1]][a+1]:!1;this.activeGallery=!0}else this.navigationObservers.previous=!1,this.activeGallery=this.navigationObservers.next=!1;gallery&&this.galleries[gallery[0]][gallery[1]][a]&&
(this.contentToFetch=this.galleries[gallery[0]][gallery[1]][a].href,this.galleryLocation={current:a+1,total:this.galleries[gallery[0]][gallery[1]].length},this.galleries[gallery[0]][gallery[1]][a+1]?($("lightwindow_next").setStyle({display:"block"}),b=this.galleries[gallery[0]][gallery[1]][a+1].title,$("lightwindow_next_title").innerHTML=b?b:""):$("lightwindow_next").setStyle({display:"none"}),this.galleries[gallery[0]][gallery[1]][a-1]?($("lightwindow_previous").setStyle({display:"block"}),a=this.galleries[gallery[0]][gallery[1]][a-
1].title,$("lightwindow_previous_title").innerHTML=a?a:""):$("lightwindow_previous").setStyle({display:"none"}));this._getParameter("lightwindow_iframe_embed")?(this.resizeTo.height=this.dimensions.viewport.height,this.resizeTo.width=this.dimensions.viewport.width):(this.resizeTo.height=this._getParameter("lightwindow_height"),this.resizeTo.width=this._getParameter("lightwindow_width"));this._processWindow();break;case "external":this._appendIframe("auto");a=this._getParameter("lightwindow_width");
b=this._getParameter("lightwindow_height");this.resizeTo.width=a&&""!=a?this._getParameter("lightwindow_width"):this.dimensions.viewport.width;this.resizeTo.height=b&&""!=b?this._getParameter("lightwindow_height"):this.dimensions.viewport.height;this._processWindow();break;case "page":new Ajax.Request(this.contentToFetch,{method:"get",parameters:"",onComplete:function(a){$("lightwindow_contents").innerHTML+=a.responseText;this.resizeTo.height=$("lightwindow_contents").scrollHeight+this.options.contentOffset.height;
this.resizeTo.width=$("lightwindow_contents").scrollWidth+this.options.contentOffset.width;this._processWindow()}.bind(this)});break;case "inline":a=this.contentToFetch,-1<a.indexOf("?")&&(a=a.substring(0,a.indexOf("?"))),a=a.substring(a.indexOf("#")+1),new Insertion.Top($("lightwindow_contents"),$(a).innerHTML),a=this._getParameter("lightwindow_width"),this.resizeTo.width=a&&""!=a?this._getParameter("lightwindow_width"):$("lightwindow_contents").scrollWidth+this.options.contentOffset.width,this.resizeTo.height=
$("lightwindow_contents").scrollHeight+this.options.contentOffset.height+60,this._toggleTroubleElements("hidden",!1),this._toggleTroubleElements("visible",!0),this._processWindow()}},_resizeWindowToFit:function(){if(this.resizeTo.height+this.dimensions.cruft.height>this.dimensions.viewport.height){var a=this.resizeTo.height/this.resizeTo.width;this.resizeTo.height=this.dimensions.viewport.height-this.dimensions.cruft.height-2*this.options.viewportPadding;if("image"==this.windowType||"media"==this.windowType&&
!this._getParameter("lightwindow_iframe_embed"))this.resizeTo.width=this.resizeTo.height/a,$("lightwindow_data_slide_inner").setStyle({width:this.resizeTo.width+"px"})}if(this.resizeTo.width+this.dimensions.cruft.width>this.dimensions.viewport.width&&(a=this.resizeTo.width/this.resizeTo.height,"inline"!=this.windowType&&(this.resizeTo.width=this.dimensions.viewport.width-2*this.dimensions.cruft.width-2*this.options.viewportPadding),"image"==this.windowType||"media"==this.windowType&&!this._getParameter("lightwindow_iframe_embed")))this.resizeTo.height=
this.resizeTo.width/a,$("lightwindow_data_slide_inner").setStyle({height:this.resizeTo.height+"px"})},_presetWindowSize:function(){this._getParameter("lightwindow_height")&&(this.resizeTo.height=parseFloat(this._getParameter("lightwindow_height")));this._getParameter("lightwindow_width")&&(this.resizeTo.width=parseFloat(this._getParameter("lightwindow_width")))},_processWindow:function(){this.dimensions.dataEffects=[];this.element.caption||this.element.author||this.activeGallery&&this.options.showGalleryCount?
(this.element.caption?($("lightwindow_data_caption").innerHTML=this.element.caption,$("lightwindow_data_caption").setStyle({display:"block"})):$("lightwindow_data_caption").setStyle({display:"none"}),this.element.author?($("lightwindow_data_author").innerHTML=this.element.author,$("lightwindow_data_author_container").setStyle({display:"block"})):$("lightwindow_data_author_container").setStyle({display:"none"}),this.activeGallery&&this.options.showGalleryCount?($("lightwindow_data_gallery_current").innerHTML=
this.galleryLocation.current,$("lightwindow_data_gallery_total").innerHTML=this.galleryLocation.total,$("lightwindow_data_gallery_container").setStyle({display:"block"})):$("lightwindow_data_gallery_container").setStyle({display:"none"}),$("lightwindow_data_slide_inner").setStyle({width:this.resizeTo.width+"px",height:"auto",visibility:"visible",display:"block"}),$("lightwindow_data_slide").setStyle({height:$("lightwindow_data_slide").getHeight()+"px",width:"1px",overflow:"hidden",display:"block"})):
($("lightwindow_data_slide").setStyle({display:"none",width:"auto"}),$("lightwindow_data_slide_inner").setStyle({display:"none",visibility:"hidden",width:this.resizeTo.width+"px",height:"0px"}));null!=this.element.title?$("lightwindow_title_bar_title").innerHTML=this.element.title:$("lightwindow_title_bar_title").innerHTML="";var a=$("lightwindow_container").getHeight(),b=$("lightwindow_container").getWidth();$("lightwindow_container").setStyle({height:"auto",width:$("lightwindow_container").getWidth()+
this.options.contentOffset.width-(this.windowActive?this.options.contentOffset.width:0)+"px"});var c=$("lightwindow_container").getHeight(),d=$("lightwindow_container").getWidth();this.containerChange={height:a-c,width:b-d};this.dimensions.container={height:$("lightwindow_container").getHeight(),width:$("lightwindow_container").getWidth()};this.dimensions.cruft={height:this.dimensions.container.height-$("lightwindow_contents").getHeight()+this.options.contentOffset.height,width:this.dimensions.container.width-
$("lightwindow_contents").getWidth()+this.options.contentOffset.width};this._presetWindowSize();this._resizeWindowToFit();this.windowActive||$("lightwindow_container").setStyle({left:-(this.dimensions.container.width/2)+"px",top:-(this.dimensions.container.height/2)+"px"});$("lightwindow_container").setStyle({height:this.dimensions.container.height+"px",width:this.dimensions.container.width+"px"});this._displayLightWindow("block","visible");this._animateLightWindow()},_animateLightWindow:function(){this.options.animationHandler?
this.options.animationHandler().bind(this):this._defaultAnimationHandler()},_handleNavigation:function(a){this.options.navigationHandler?this.options.navigationHandler().bind(this,a):this._defaultDisplayNavigation(a)},_handleTransition:function(){this.options.transitionHandler?this.options.transitionHandler().bind(this):this._defaultTransitionHandler()},_handleFinalWindowAnimation:function(a){this.options.finalAnimationHandler?(a=this.options.finalAnimationHandler())&&a.bind&&a.bind():this._defaultfinalWindowAnimationHandler(a)},
_handleGalleryAnimation:function(a){this.options.galleryAnimationHandler?this.options.galleryAnimationHandler().bind(this,a):this._defaultGalleryAnimationHandler(a)},_defaultDisplayNavigation:function(a){a?$("lightwindow_navigation").setStyle({display:"block",height:$("lightwindow_contents").getHeight()+"px",width:"100%",marginTop:this.options.dimensions.titleHeight+"px"}):$("lightwindow_navigation").setStyle({display:"none",height:"auto",width:"auto"})},_defaultAnimationHandler:function(){if(this.element.caption||
this.element.author||this.activeGallery&&this.options.showGalleryCount)$("lightwindow_data_slide").setStyle({display:"none",width:"auto"}),this.dimensions.dataEffects.push(new Effect.SlideDown("lightwindow_data_slide",{sync:!0}),new Effect.Appear("lightwindow_data_slide",{sync:!0,from:0,to:1}));"false"!=this._getParameter("lightwindow_open_animation")&&$("lightwindow_title_bar_inner").setStyle({display:"none"});this.dimensions.dataEffects.push(new Effect.Appear("lightwindow_title_bar_inner",{sync:!0,
from:0,to:1}));this.options.hideGalleryTab||(this._handleGalleryAnimation(!1),0==$("lightwindow_galleries_tab_container").getHeight()&&(this.dimensions.dataEffects.push(new Effect.Morph("lightwindow_galleries_tab_container",{sync:!0,style:{height:"20px",marginTop:"0px"}})),$("lightwindow_galleries").setStyle({width:"0px"})));var a=!1,b=this.element.width;this.element.width=null;var c=this._getParameter("lightwindow_width");this.element.width=b;c&&""!=c?this.resizeTo.width=c:$("lightwindow_contents").getWidth()>
this.resizeTo.width&&(this.resizeTo.width=$("lightwindow_container").getWidth());this.resizeTo.width=parseInt(this.resizeTo.width);b=this.dimensions.container.width-$("lightwindow_contents").getWidth()+this.resizeTo.width+this.options.contentOffset.width;if(b!=$("lightwindow_container").getWidth()||b!=$("lightwindow_title_bar").getWidth())if(Prototype.Browser.IE&&"external"!=this.element.type&&(!this._getParameter("lightwindow_width")||""==!this._getParameter("lightwindow_width"))){$("lightwindow_contents").scrollWidth>
this.resizeTo.width&&(this.resizeTo.width=$("lightwindow_contents").scrollWidth);"false"!=this._getParameter("lightwindow_open_animation")?$("lightwindow_title_bar").setStyle({width:this.resizeTo.width+65}):$("lightwindow_title_bar").setStyle({width:this.resizeTo.width});var c=100*(1*this.resizeTo.width+130)/this.dimensions.container.width,d=100*($("lightwindow_contents").getWidth()/($("lightwindow_contents").getWidth()+this.options.contentOffset.width)),d=100,b=100*(b/this.dimensions.container.width),
b=c;"false"!=this._getParameter("lightwindow_open_animation")?new Effect.Parallel([new Effect.Scale("lightwindow_contents",c,{scaleFrom:d,sync:!0,scaleY:!1,scaleContent:!1}),new Effect.Scale("lightwindow_container",b,{sync:!0,scaleY:!1,scaleFromCenter:!0,scaleContent:!1})],{duration:this.duration,delay:0.25,queue:{position:"end",scope:"lightwindowAnimation"}}):($("lightwindow_contents").setStyle({width:this.resizeTo.width+"px"}),$("lightwindow_container").setStyle({width:this.resizeTo.width+"px",
left:0-this.resizeTo.width/2+"px"}),$("lightwindow_container").parentElement.setStyle({left:"50%"}),$("lightwindow_container").setStyle({width:this.resizeTo.width+"px"}))}else c=100*(this.resizeTo.width/$("lightwindow_contents").getWidth()),$("lightwindow_contents").getWidth(),$("lightwindow_contents").getWidth(),d=$("lightwindow_contents").offsetWidth*c/100+20,d+="px",$("lightwindow_title_bar").setStyle({width:d}),d={scaleFrom:0,sync:!0,scaleY:!1,scaleContent:!1},"false"!=this._getParameter("lightwindow_open_animation")?
new Effect.Parallel([new Effect.Scale("lightwindow_contents",c,d),new Effect.Scale("lightwindow_container",100*(b/this.dimensions.container.width),{sync:!0,scaleY:!1,scaleFromCenter:!0,scaleContent:!1})],{duration:this.duration,queue:{position:"end",scope:"lightwindowAnimation"}}):($("lightwindow_contents").setStyle({width:this.resizeTo.width+"px"}),$("lightwindow_container").setStyle({width:this.resizeTo.width+"px",left:0-b/2+"px"})),500<this.resizeTo.width?(d=parseInt(this.resizeTo.width,10)+20,
$("lightwindow_title_bar").setStyle({width:d+"px"})):$("lightwindow_title_bar").setStyle({width:this.resizeTo.width+"px"});b=this.element.height;this.element.height=null;c=this._getParameter("lightwindow_height");this.element.height=b;c&&""!=c?this.resizeTo.height=c:$("lightwindow_contents").getHeight()>this.resizeTo.height&&(this.resizeTo.height=$("lightwindow_contents").getHeight());this.resizeTo.height=parseInt(this.resizeTo.height);b=this.dimensions.container.height-$("lightwindow_contents").getHeight()+
this.resizeTo.height+this.options.contentOffset.height;b!=$("lightwindow_container").getHeight()&&("false"!=this._getParameter("lightwindow_open_animation")?new Effect.Parallel([new Effect.Scale("lightwindow_contents",100*(this.resizeTo.height/$("lightwindow_contents").getHeight()),{scaleFrom:100*($("lightwindow_contents").getHeight()/($("lightwindow_contents").getHeight()+this.options.contentOffset.height)),sync:!0,scaleX:!1,scaleContent:!1}),new Effect.Scale("lightwindow_container",100*(b/this.dimensions.container.height),
{sync:!0,scaleX:!1,scaleFromCenter:!0,scaleContent:!1})],{duration:this.duration,afterFinish:function(){0<this.dimensions.dataEffects.length&&(this.options.hideGalleryTab||$("lightwindow_galleries").setStyle({width:this.resizeTo.width+"px"}),new Effect.Parallel(this.dimensions.dataEffects,{duration:this.duration,afterFinish:function(){this._finishWindow()}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}}))}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}}):($("lightwindow_contents").setStyle({height:this.resizeTo.height+
"px"}),$("lightwindow_container").setStyle({height:this.resizeTo.height+"px",top:0-this.resizeTo.height/2+"px"}),this._finishWindow()),a=!0);!a&&0<this.dimensions.dataEffects.length&&new Effect.Parallel(this.dimensions.dataEffects,{duration:this.duration,beforeStart:function(){this.options.hideGalleryTab||$("lightwindow_galleries").setStyle({width:this.resizeTo.width+"px"});(0!=this.containerChange.height||0!=this.containerChange.width)&&new Effect.MoveBy("lightwindow_container",this.containerChange.height,
this.containerChange.width,{transition:Effect.Transitions.sinoidal})}.bind(this),afterFinish:function(){this._finishWindow()}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}})},_defaultfinalWindowAnimationHandler:function(){"media"==this.windowType||this._getParameter("lightwindow_loading_animation")?($("lightwindow_loading")&&Element.hide("lightwindow_loading"),this._handleNavigation(this.activeGallery),this._setStatus(!1)):$("lightwindow_loading")&&Effect.Fade("lightwindow_loading",
{duration:0.75,delay:1,afterFinish:function(){"image"!=this.windowType&&("media"!=this.windowType&&"external"!=this.windowType)&&$("lightwindow_contents").setStyle({overflow:"auto"});this._handleNavigation(this.activeGallery);this._defaultGalleryAnimationHandler();this._setStatus(!1)}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}})},_defaultGalleryAnimationHandler:function(a){if(this.activeGallery)$("lightwindow_galleries").setStyle({display:"block",marginBottom:$("lightwindow_data_slide").getHeight()+
this.options.contentOffset.height/2+"px"}),$("lightwindow_navigation").setStyle({height:$("lightwindow_contents").getHeight()-20+"px"});else return $("lightwindow_galleries").setStyle({display:"none"}),$("lightwindow_galleries_tab_container").setStyle({height:"0px",marginTop:"20px"}),$("lightwindow_galleries_list").setStyle({height:"0px"}),!1;a&&(0==$("lightwindow_galleries_list").getHeight()?(a=0.8*$("lightwindow_contents").getHeight(),$("lightwindow_galleries_tab_span").className="down"):(a=0,$("lightwindow_galleries_tab_span").className=
"up"),new Effect.Morph("lightwindow_galleries_list",{duration:this.duration,transition:Effect.Transitions.sinoidal,style:{height:a+"px"},beforeStart:function(){$("lightwindow_galleries_list").setStyle({overflow:"hidden"})},afterFinish:function(){$("lightwindow_galleries_list").setStyle({overflow:"auto"})},queue:{position:"end",scope:"lightwindowAnimation"}}))},_defaultTransitionHandler:function(){this.dimensions.dataEffects=[];"none"!=$("lightwindow_data_slide").getStyle("display")&&this.dimensions.dataEffects.push(new Effect.SlideUp("lightwindow_data_slide",
{sync:!0}),new Effect.Fade("lightwindow_data_slide",{sync:!0,from:1,to:0}));this.options.hideGalleryTab||(0!=$("lightwindow_galleries").getHeight()&&!this.options.hideGalleryTab&&this.dimensions.dataEffects.push(new Effect.Morph("lightwindow_galleries_tab_container",{sync:!0,style:{height:"0px",marginTop:"20px"}})),0!=$("lightwindow_galleries_list").getHeight()&&($("lightwindow_galleries_tab_span").className="up",this.dimensions.dataEffects.push(new Effect.Morph("lightwindow_galleries_list",{sync:!0,
style:{height:"0px"},transition:Effect.Transitions.sinoidal,beforeStart:function(){$("lightwindow_galleries_list").setStyle({overflow:"hidden"})},afterFinish:function(){$("lightwindow_galleries_list").setStyle({overflow:"auto"})}}))));new Effect.Parallel(this.dimensions.dataEffects,{duration:this.duration,afterFinish:function(){this._loadWindow()}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}})},_defaultFormHandler:function(a){var a=Event.element(a).parentNode,b=Form.serialize(this._getParameter("lightwindow_form",
a.getAttribute("params")));"post"==this.options.formMethod?new Ajax.Request(a.href,{method:"post",postBody:b,onComplete:this.openWindow.bind(this,a)}):"get"==this.options.formMethod&&new Ajax.Request(a.href,{method:"get",parameters:b,onComplete:this.openWindow.bind(this,a)})},_finishWindow:function(){"external"==this.windowType?($("lightwindow_iframe").setAttribute("src",this.contentToFetch),this._handleFinalWindowAnimation(1)):this._handleFinalWindowAnimation(0)}};
Event.observe(document,"dom:loaded",lightwindowInit,!1);var myLightWindow=null;function lightwindowInit(){if(Prototype.Browser.IE6){if("undefined"==typeof LITBox||null==LITBox)myLightWindow=new lightwindow}else myLightWindow=new lightwindow}var jsPath="/w2gi/javascript/";
window.dhtmlHistory={isIE:!1,isOpera:!1,isSafari:!1,isKonquerer:!1,isGecko:!1,isSupported:!1,create:function(a){var b=this,c=navigator.userAgent.toLowerCase(),d=navigator.platform.toLowerCase(),e=navigator.vendor||"";"KDE"===e?(this.isKonqueror=!0,this.isSupported=!1):"undefined"!==typeof window.opera?this.isSupported=this.isOpera=!0:"undefined"!==typeof document.all?this.isSupported=this.isIE=!0:-1<e.indexOf("Apple Computer, Inc.")?(this.isSafari=!0,this.isSupported=-1<d.indexOf("mac")):-1!=c.indexOf("gecko")&&
(this.isSupported=this.isGecko=!0);window.historyStorage.setup(a);this.isSafari?this.createSafari():this.isOpera&&this.createOpera();this.currentLocation=a=this.getCurrentLocation();this.isIE&&this.createIE(a);this.addEventListener(window,"unload",function(){b.firstLoad=null});this.isIE?this.ignoreLocationChange=!0:historyStorage.hasKey(this.PAGELOADEDSTRING)?(this.ignoreLocationChange=!1,this.fireOnNewListener=!0):(this.firstLoad=this.ignoreLocationChange=!0,historyStorage.put(this.PAGELOADEDSTRING,
!0));this.checkLocation()},initialize:function(){this.isIE&&(historyStorage.hasKey(this.PAGELOADEDSTRING)?(this.fireOnNewListener=!0,this.firstLoad=!1):(this.fireOnNewListener=!1,this.firstLoad=!0,historyStorage.put(this.PAGELOADEDSTRING,!0)))},addListener:function(a){this.listener=a;this.fireOnNewListener&&(this.fireHistoryEvent(this.currentLocation),this.fireOnNewListener=!1)},addEventListener:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})},
add:function(a,b){if(this.isSafari)a=this.removeHash(a),historyStorage.put(a,b),this.currentLocation=a,window.location.hash=a,this.putSafariState(a);else{var c=this;window.setTimeout(function(){0<c.currentWaitTime&&(c.currentWaitTime-=c.waitTime);a=c.removeHash(a);if(document.getElementById(a)&&c.debugMode)throw Error("Exception: History locations can not have the same value as _any_ IDs that might be in the document, due to a bug in IE; please ask the developer to choose a history location that does not match any HTML IDs in this document. The following ID is already taken and cannot be a location: "+
a);historyStorage.put(a,b);c.ignoreLocationChange=!0;c.ieAtomicLocationChange=!0;c.currentLocation=a;window.location.hash=a;c.isIE&&(c.iframe.src=jsPath+"blank.html?"+a);c.ieAtomicLocationChange=!1},this.currentWaitTime);this.currentWaitTime+=this.waitTime}},isFirstLoad:function(){return this.firstLoad},getVersion:function(){return"0.6"},getCurrentLocation:function(){return this.isSafari?this.getSafariState():this.getCurrentHash()},getCurrentHash:function(){var a=window.location.href,b=a.indexOf("#");
return 0<=b?a.substr(b+1):""},PAGELOADEDSTRING:"DhtmlHistory_pageLoaded",listener:null,waitTime:200,currentWaitTime:0,currentLocation:null,iframe:null,safariHistoryStartPoint:null,safariStack:null,safariLength:null,ignoreLocationChange:null,fireOnNewListener:null,firstLoad:null,ieAtomicLocationChange:null,createIE:function(a){this.waitTime=400;document.write('<iframe frameborder="0" id="rshHistoryFrame" style="'+(historyStorage.debugMode?"width: 800px;height:80px;border:1px solid black;":historyStorage.hideStyles)+
'" src="'+jsPath+"blank.html?"+a+'"></iframe>');this.iframe=document.getElementById("rshHistoryFrame")},createOpera:function(){this.waitTime=400;document.write('<img src="javascript:location.href=\'javascript:dhtmlHistory.checkLocation();\';" style="'+historyStorage.hideStyles+'" />')},createSafari:function(){var a=historyStorage.debugMode?"width:800px;height:20px;border:1px solid black;margin:0;padding:0;":historyStorage.hideStyles;document.write('<form id="rshSafariForm" style="'+(historyStorage.debugMode?
historyStorage.showStyles:historyStorage.hideStyles)+'"><input type="text" style="'+a+'" id="rshSafariStack" value="[]"/><input type="text" style="'+a+'" id="rshSafariLength" value=""/></form>');this.safariStack=document.getElementById("rshSafariStack");this.safariLength=document.getElementById("rshSafariLength");historyStorage.hasKey(this.PAGELOADEDSTRING)?this.safariHistoryStartPoint=this.safariLength.value:(this.safariHistoryStartPoint=history.length,this.safariLength.value=this.safariHistoryStartPoint)},
getSafariStack:function(){return historyStorage.fromJSON(this.safariStack.value)},getSafariState:function(){return this.getSafariStack()[history.length-this.safariHistoryStartPoint-1]},putSafariState:function(a){var b=this.getSafariStack();b[history.length-this.safariHistoryStartPoint]=a;this.safariStack.value=historyStorage.toJSON(b)},fireHistoryEvent:function(a){var b=historyStorage.get(a);this.listener.call(null,a,b)},checkLocation:function(){if(!this.isIE&&this.ignoreLocationChange)this.ignoreLocationChange=
!1;else if(this.isIE||!this.ieAtomicLocationChange){var a=this.getCurrentLocation();if(a!=this.currentLocation){this.ieAtomicLocationChange=!0;if(this.isIE&&this.getIframeHash()!=a)this.iframe.src=jsPath+"blank.html?"+a;else if(this.isIE)return;this.currentLocation=a;this.ieAtomicLocationChange=!1;this.fireHistoryEvent(a)}}},getIframeHash:function(){var a=String(this.iframe.contentWindow.document.location.search);1==a.length&&"?"==a.charAt(0)?a="":2<=a.length&&"?"==a.charAt(0)&&(a=a.substring(1));
return a},removeHash:function(a){return null===a||void 0===a?null:""===a?"":1==a.length&&"#"==a.charAt(0)?"":1<a.length&&"#"==a.charAt(0)?a.substring(1):a},iframeLoaded:function(a){this.ignoreLocationChange?this.ignoreLocationChange=!1:(a=String(a.search),1==a.length&&"?"==a.charAt(0)?a="":2<=a.length&&"?"==a.charAt(0)&&(a=a.substring(1)),window.location.hash=a,this.fireHistoryEvent(a))}};
window.historyStorage={setup:function(a){"undefined"!==typeof a&&(a.debugMode&&(this.debugMode=a.debugMode),a.toJSON&&(this.toJSON=a.toJSON),a.fromJSON&&(this.fromJSON=a.fromJSON));document.write('<form id="rshStorageForm" style="'+(this.debugMode?historyStorage.showStyles:historyStorage.hideStyles)+'"><textarea id="rshStorageField" style="'+(historyStorage.debugMode?"width: 800px;height:80px;border:1px solid black;":historyStorage.hideStyles)+'"></textarea></form>');this.storageField=document.getElementById("rshStorageField");
"undefined"!==typeof window.opera&&this.storageField.focus()},put:function(a,b){this.assertValidKey(a);this.hasKey(a)&&this.remove(a);this.storageHash[a]=b;this.saveHashTable()},get:function(a){this.assertValidKey(a);this.loadHashTable();a=this.storageHash[a];void 0===a&&(a=null);return a},remove:function(a){this.assertValidKey(a);this.loadHashTable();delete this.storageHash[a];this.saveHashTable()},reset:function(){this.storageField.value="";this.storageHash={}},hasKey:function(a){this.assertValidKey(a);
this.loadHashTable();return"undefined"!==typeof this.storageHash[a]},isValidKey:function(a){return"string"===typeof a},showStyles:"border:0;margin:0;padding:0;",hideStyles:"left:-1000px;top:-1000px;width:1px;height:1px;border:0;position:absolute;",debugMode:!1,storageHash:{},hashLoaded:!1,storageField:null,assertValidKey:function(a){if(!this.isValidKey(a)&&this.debugMode)throw Error("Please provide a valid key for window.historyStorage. Invalid key = "+a+".");},loadHashTable:function(){if(!this.hashLoaded){var a=
this.storageField.value;""!==a&&null!==a&&(this.storageHash=this.fromJSON(a),this.hashLoaded=!0)}},saveHashTable:function(){this.loadHashTable();var a=this.toJSON(this.storageHash);this.storageField.value=a},toJSON:function(a){return a.toJSONString()},fromJSON:function(a){return a.parseJSON()}};
var ace={request:function(a,b,c){var d=ace.xml.getXMLData("ajaxurl"),e=a&&a.nodeType?Form.serialize(a,!0):a,f=c&&c.formdataID?c.formdataID:a.readAttribute("id"),g=c&&c.objectName?c.objectName:null,h=c&&c.like?c.like:null,a=ace.xml.getFormData(a,f,g),l=c?c.tagName:null,k=c&&c.geoip;ace.util.numberFormat&&(e=ace.util.format(e));c&&c.extendGetVals&&(e=Object.extend(e,ace.util.retrieveGetVals()));e=a?this._getRequestXML(a,e,k,h):this._generateRequestXML(f,e,l,g,k,h,c);this.ajaxRequest(d,e,b,c);return e},
ajaxRequest:function(a,b,c,d){if(ace.locale&&ace.locale.current){var b=ace.locale.getTextXML(b),e=ace.locale.current.locale;a.match(/([?&]lang=)/)?a=a.replace(/([?&]lang=)([^&]*)/,"$1"+e):(a=a.replace(/[?]$/,""),a+="?lang="+e)}var e={xml_request:b},f=ace.cache.get(b);f?(c||Prototype.emptyFunction)(f):(b=b.gsub(/\cA|\cB|\cC|\cD|\cE|\cF|\cG|\cH|\cI|\cJ|\cK|\cL|\cM|\cN|\cO|\cP|\cQ|\cR|\cS|\cT|\cU|\cV|\cW|\cX|\cY|\cZ/,""),ace.cache.add(b),b={parameters:e,method:"get",onComplete:this._processResponse.bind(this,
c,e,d),onException:this._reportError},b=Object.extend(b,d||{}),new Ajax.Request(a,b))},_processResponse:function(a,b,c,d){if(this._checkResponse(c,d)&&a)switch(typeof a){case "function":try{if(a(d.responseXML)&&(ace.cache.add(b.xml_request,d.responseXML),c&&c.onHistory))c.onHistory(b.xml_request,a)}catch(e){ace.util.alert(e,{height:100})}break;case "boolean":a&&ace.cache.add(b.xml_request,d.responseXML);break;default:throw Error("Bad callback type.");}},_checkResponse:function(a,b){if(null==b)return!1;
var c=b.getHeader("Location");if(c)return location.href=c,!1;c=b.getHeader("content-type");if(!c)return!1;var d=ace._getResponseCode(b.responseXML);if(c.include("text/html")||"999"==d)return this._sessionEnd(b.responseXML),!1;if(!c.include("xml")&&b.responseText)return ace.util.alert(b.responseText),!1;if(!c.include("xml")||!b.responseXML||b.responseText.empty())return!1;if("1"!=d){if(a&&a.onError)a.onError(b.responseXML);if(a&&!1==a.alertError)return!1;c=ace._getMessageText(b.responseXML);ace.util.alert(c,
{height:100});return!1}return!b.responseXML.getElementsByTagName("response")[0].firstChild?!1:!0},_sessionEnd:function(a){document.body.innerHTML=a.documentElement.textContent},_reportError:function(a,b){if(a.getHeader&&a.getHeader("Content-Type")&&a.getHeader("Content-Type").include&&a.getHeader("Content-Type").include("html")||!b||b&&b.message&&b.message.include("xml"))return document.body.innerHTML=a.transport.responseText,!1;ace.util.alert("Internal error: "+b,{height:100})},_getResponseCode:function(a){return!a?
"":(a=a.getElementsByTagName("response")[0])?a.getAttribute("code"):""},_getMessageText:function(a){return a.getElementsByTagName("text")[0].firstChild.nodeValue},_generateRequestXML:function(a,b,c,d,e,f,g){var h=ace.xml.getXMLData("appkey"),l=this.locationmanager.getAccountXML(),e=e?"<geoip>1</geoip>":"",f=f?' like="'+Math.random()+'"':"",k="<request><appkey>"+h+"</appkey>"+l+e+'<formdata id="'+a+'"'+f+(g&&g.softmatch?' softmatch="1" ':"")+">";d&&(k+="<objectname>"+d+"</objectname>");g&&g.limit&&
(k+="<limit>"+g.limit+"</limit>");g&&g.offset&&(k+="<offset>"+g.offset+"</offset>");g&&g.order&&(k+="<order>"+g.order+"</order>");g&&g.dataview&&(k+="<dataview>"+g.dataview+"</dataview>");g&&g.columns&&(k+="<columns>"+g.columns+"</columns>");g&&g.distinct&&(k+="<distinct>"+g.distinct+"</distinct>");g&&g.baseParams&&$H(g.baseParams).each(function(a){k+="<"+a.key+">"+a.value+"</"+a.key+">"}.bind(this));c&&(k+="<"+c+">");b&&$H(b).each(function(a){k+=this._generateXML(a.key,a.value,c,g)}.bind(this));
c&&(k+="</"+c+">");return k+="</formdata></request>"},_generateXML:function(a,b,c,d){d&&d.escapeHTML&&(b=b.escapeHTML());var e="",f="";"where"==c&&"<"!=b.substr(0,1)&&(c=d&&d.compareStr?d.compareStr:"eq",e="<"+c+">",f="</"+c+">");return"object"==typeof b?b.inject("",function(b,c){return b+"<"+a+">"+c+"</"+a+">"}):"<"+a+">"+e+b+f+"</"+a+">"},_getRequestXML:function(a,b,c){var d=ace.xml.getXMLData("appkey"),e=ace.locationmanager.getAccountXML(),c=c?"<geoip>1</geoip>":"",a=this._getQueryXML(a,b,1),a=
ace.xml.toString(a);return"<request><appkey>"+d+"</appkey>"+e+c+a+"</request>"},_getQueryXML:function(a,b){var c=a.attributes,d=c.length;if(1<d)for(var e=0;e<d;e++)"like"==c[e].nodeName&&(c[e].value=Math.random());var f=ace.util.cleanWhitespace(a.cloneNode(!0));if(!b)return f;var g=Prototype.Browser.IE?new ActiveXObject("Microsoft.XMLDOM"):document;$H(b).each(function(a){if(""!=a.value){var b=f.getElementsByTagName(a.key);if(!b||0==b.length)b=f.getElementsByTagName(a.key.toUpperCase());if(!b||0==
b.length)b=f.getElementsByTagName(a.key.toLowerCase());if(b){var c=Object.isArray(a.value)?a.value.join("|"):a.value;$A(b).each(function(a){var b=a.childNodes.length;if(b&&0<b){for(var b=Prototype.Browser.IE?a.firstChild:$(a).firstChild,d=!1,f=Prototype.Browser.IE?a.parentNode:$(a).parentNode;null!=f&&f!=f.parentNode;)"WHERE"==f.tagName.toUpperCase()&&(d=!0),f=f.parentNode;if(1==b.nodeType)if(d)if(d=b.tagName,d=d.toUpperCase(),d==a.tagName||"IN"==d||"AND"==d||"OR"==d)if(b.childNodes&&0<b.childNodes.length){a=
b.childNodes[0];b=a.nodeValue.match(/,/)?",":"|";d=a.nodeValue.split(b);f=!0;for(e=0;e<d.length&&f;e++)d[e]==c&&(f=!1);f&&(a.nodeValue+=b+c)}else b.appendChild(ace.util.createTextNode(g,c));else(!b.childNodes||0==b.childNodes.length)&&b.appendChild(ace.util.createTextNode(g,c));else a=b.nodeValue,b.appendChild(ace.util.createTextNode(g,null==a?c:a+"|"+c));else a.replaceChild(ace.util.createTextNode(g,c),b)}else a.appendChild(ace.util.createTextNode(g,c))})}}});return f},VERSION_NUMBER:"1.79.6",components:{request:function(a,
b){ace.request({view:a},function(a){if(!b)return!0;a=ace.xml.parse(a).sort(function(a,b){var c=parseInt(a.ORDER),d=parseInt(b.ORDER);return isNaN(c)||isNaN(d)?0:c-d});try{return b(a)}catch(d){ace.util.alert(d,{height:100})}},{formdataID:"getlist",objectName:"ComponentView"})}},cache:{_cache:{},destroy:function(){this._cache=null},requests:function(){var a='<div style="font-size: 11px;">'+$H(this._cache).keys().map(function(a){return decodeURIComponent(a).escapeHTML()}).join("<p/>")+"</div>";ace.util.alert(a,
{width:1E3,height:500})},add:function(a,b){this._cache[a]=b},get:function(a){return this._cache[a]}},geo:{googleLangCodes:[{name:"ARABIC",code:"ar"},{name:"BASQUE",code:"eu"},{name:"BULGARIAN",code:"bg"},{name:"BENGALI",code:"bn"},{name:"CATALAN",code:"ca"},{name:"CZECH",code:"cs"},{name:"DANISH",code:"da"},{name:"GERMAN",code:"de"},{name:"GREEK",code:"el"},{name:"ENGLISH",code:"en"},{name:"ENGLISH (AUSTRALIAN)",code:"en-AU"},{name:"ENGLISH (GREAT BRITAIN)",code:"en-GB"},{name:"SPANISH",code:"es"},
{name:"BASQUE",code:"eu"},{name:"FARSI",code:"fa"},{name:"FINNISH",code:"fi"},{name:"FILIPINO",code:"fil"},{name:"FRENCH",code:"fr"},{name:"GALICIAN",code:"gl"},{name:"GUJARATI",code:"gu"},{name:"HINDI",code:"hi"},{name:"CROATIAN",code:"hr"},{name:"HUNGARIAN",code:"hu"},{name:"INDONESIAN",code:"id"},{name:"ITALIAN",code:"it"},{name:"HEBREW",code:"iw"},{name:"JAPANESE",code:"ja"},{name:"KANNADA",code:"kn"},{name:"KOREAN",code:"ko"},{name:"LITHUANIAN",code:"lt"},{name:"LATVIAN",code:"lv"},{name:"MALAYALAM",
code:"ml"},{name:"MARATHI",code:"mr"},{name:"DUTCH",code:"nl"},{name:"NORWEGIAN",code:"no"},{name:"POLISH",code:"pl"},{name:"PORTUGUESE",code:"pt"},{name:"PORTUGUESE (BRAZIL)",code:"pt-BR"},{name:"PORTUGUESE (PORTUGAL)",code:"pt-PT"},{name:"ROMANIAN",code:"ro"},{name:"RUSSIAN",code:"ru"},{name:"SLOVAK",code:"sk"},{name:"SLOVENIAN",code:"sl"},{name:"SERBIAN",code:"sr"},{name:"SWEDISH",code:"sv"},{name:"TAGALOG",code:"tl"},{name:"TAMIL",code:"ta"},{name:"TELUGU",code:"te"},{name:"THAI",code:"th"},{name:"TURKISH",
code:"tr"},{name:"UKRAINIAN",code:"uk"},{name:"VIETNAMESE",code:"vi"},{name:"CHINESE",code:"zh-CN"},{name:"CHINESE (SIMPLIFIED)",code:"zh-CN"},{name:"CHINESE (TRADITIONAL)",code:"zh-TW"}],initialize:function(a){var b={};"undefined"!=typeof Console&&$("accounts")?b.schemaname=$("accounts").getValue():b.appkey=ace.xml.getXMLData("appkey");ace.request(b,function(b){b=ace.xml.parse(b);ace.w2gilocator=b;ace.useClientSideDir=!1;ace.useClientSideGeo=!1;for(var d=0;d<b.length;d++)if("1"==b[d].CLIENTSIDEGEOCODING){ace.useClientSideGeo=
!0;break}for(d=0;d<b.length;d++)if("1"==b[d].CLIENTSIDEDIRECTIONS){ace.useClientSideDir=!0;break}ace._distanceuom=b.length?b[0].RADIUSUOM:"mile";ace._timeuom=b.length?b[0].TIMEUOM:"minute";b=[];ace.useClientSideDir&&"undefined"==typeof ace.cdirections&&b.push("/w2gi/javascript/ace/ace-cdirections.js");var e=0;if((ace.useClientSideDir||ace.useClientSideGeo)&&("undefined"===typeof google||"undefined"===typeof google.maps)){var f=d="";Prototype.Browser.IE&&(f=(f=ace.xml.getFormData(null,"drivingdirections").xml.match(/<language>(.*)<\/language>/))&&
1<f.length?f[1]:"");var g=$$("route language");0<g.length&&(f=g[0].innerHTML);if(f&&(f=ace.geo.googleLangCodes.detect(function(a,b){return b.name.toLowerCase()==a.toLowerCase()||b.code==a}.curry(f))))d=f.code;f="";f=/^https/.test(window.location.protocol)?"https://maps-api-ssl.google.com":"http://maps.googleapis.com";f+="/maps/api/js?v=3&sensor=false&callback=ace.geo._googleloaded&client=gme-where2getit";d.blank()||(f+="&language="+d);b.push(f);e++;ace.geo._googleloaded=function(){e--;a&&0>=e&&a()}.bind(this)}ace.useClientSideGeo&&
"undefined"==typeof ace.cgeo&&b.push("/w2gi/javascript/ace/ace-cgeo3.js");d=0;for(f=b.length;d<f;d++)g=document.createElement("script"),g.src=b[d],g.type="text/javascript",(document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body).appendChild(g);a&&(!ace.geo._googleloaded&&0>=e)&&a()},{formdataID:"getlist",tagName:"where",objectName:"W2GILocator",alertError:!1,asynchronous:!1})},code:function(a,b,c){function d(a){if(!b)return!0;a=ace.xml.parse(a);try{return b(a)}catch(c){ace.util.alert(c,
{height:100})}return!1}c=Object.extend(c||{},{formdataID:"geocoder"});a=Object.isString(a)?{addressline:a}:a;"undefined"!=typeof ace.cgeo?ace.cgeo.geocode(a,d,c):ace.request(a,d,c)},reverse:function(a,b,c){function d(a){if(!b)return!0;a=ace.xml.parse(a);try{return b(a[0])}catch(c){ace.util.alert(c,{height:100})}return!1}c=Object.extend(c||{},{formdataID:"reversegeocoder"});"undefined"!=typeof ace.cgeo&&null!=ace.cgeo?ace.cgeo.reverseGeocode(a,d,c):ace.request(a,d,c)},addGPSObserver:function(a,b,c,
d){geo_position_js&&geo_position_js.init()?(d=d||{},a&&$(a).observe("click",this.gpsSearch.bind(this,a,b,c,d)),d.now&&this.gpsSearch(a,b,c,d),a&&$(a).show()):a&&$(a).hide()},gpsSearch:function(a,b,c,d,e){e&&e.stop();success=d&&d.onGPSSuccess?d.onGPSSuccess:null;error=d&&d.onGPSError?d.onGPSError:null;updatecb=d&&d.updateCallBack?d.updateCallBack:null;options=d&&d.updateOptions?d.updateOptions:{};options=Object.extend({gps:!0},options);geo_position_js.getCurrentPosition(function(a){Object.isElement(c)?
(c.addressline.value="",c.latitude.value=a.coords.latitude,c.longitude.value=a.coords.longitude,c.country&&(c.country.value="")):(c.latitude=a.coords.latitude,c.longitude=a.coords.longitude);b&&ace.table.update(b,c,function(a){var b=a.getElementsByTagName("collection")[0].getAttribute("city")||"",d=a.getElementsByTagName("collection")[0].getAttribute("postalcode")||"",e=a.getElementsByTagName("collection")[0].getAttribute("state")||"",f=a.getElementsByTagName("collection")[0].getAttribute("province")||
"",p=a.getElementsByTagName("collection")[0].getAttribute("country")||"",e=e||f;c.addressline&&(c.addressline.value=b+" "+e+" "+d);c.country&&(c.country.value=p);return"function"==typeof updatecb?updatecb(a):"boolean"==typeof updatecb?updatecb:!1}.bind(this),options);"function"==typeof success&&success(c)}.bind(this),function(b){"function"==typeof error?error(b):$(a)&&$(a).hide()}.bind(this),{maximumAge:0})}},xml:{parse:function(a){var b=this.findDeepestElement(a),a=a.getElementsByTagName(b?b.parentNode.tagName:
null);return this.parseNodes(a)},parseNodes:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=this.parseNode(a[c],""+(c+1));return b},parseNode:function(a,b){for(var c=a.getElementsByTagName("*"),d={},e=c.length,f=0;f<e;f++){var g=this.getNodeValue(c[f])||"";d[c[f].tagName.toUpperCase()]=g}!d.RECNUM&&b&&(d.RECNUM=b);!d.POINUM&&b&&(d.POINUM=b);return d},parseXMLString:function(a){var b=a.indexOf("<");0<b&&(a=a.substring(b));return ace.util.Try(function(){var b=new ActiveXObject("Microsoft.XMLDOM");
b.loadXML(a);return b},function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;b.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1);b.overrideMimeType&&b.overrideMimeType("text/xml");b.send(null);return b.responseXML})},getCollectionName:function(a,b){return a.getElementsByTagName("collection")[b||0].getAttribute("name")},getCollection:function(a,b){var c=a.getElementsByTagName("collection");return b?$A(c).find(function(a){return a.getAttribute("name")==
b}):c[0]},getCollections:function(a,b){var c=a.getElementsByTagName("collection");return b?$A(c).findAll(function(a){return a.getAttribute("name")==b}):c},findDeepestElement:function(a){if(!a||!a.hasChildNodes())return null;for(var b=null,c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType){b=this.findDeepestElement(d)||d;break}}return b},getNodeValue:function(a){if(null==a)return null;if(!a.firstChild)return a.nodeValue;if(1>=a.childNodes.length)return a.firstChild.nodeValue;var b=
"";for(i=0;i<a.childNodes.length;i++)b=1==a.childNodes[i].nodeType&&0==a.childNodes[i].childNodes.length?b+("<"+a.childNodes[i].tagName+">"):b+a.childNodes[i].nodeValue;return b},toString:function(a,b){var c=[];if(1==a.nodeType){if(!b){c.push("<");c.push(a.tagName.toLowerCase());for(var d=0;d<a.attributes.length;d++)""!=a.attributes[d].nodeValue&&(c.push(" "),c.push(a.attributes[d].nodeName.toLowerCase()),c.push('="'),c.push(a.attributes[d].nodeValue),c.push('"'));c.push(">")}for(d=0;d<a.childNodes.length;d++)c.push(this.toString(a.childNodes[d]));
b||(c.push("</"),c.push(a.tagName.toLowerCase()),c.push(">"))}else 3==a.nodeType&&c.push(a.nodeValue);return c.join("")},getXML:function(a){return $A($(a&&a.nodeType?a:document).getElementsByTagName("xml")).map(function(a){if(Prototype.Browser.IE){var c=new ActiveXObject("MSXML2.DOMDocument");c.loadXML(a.innerHTML);return c}return a})},getXMLData:function(a,b){var c=this.getXML(b)[0];c||(c=document);c=c.getElementsByTagName(a)[0];return this.getNodeValue(c)||""},getFormData:function(a,b,c){var d=
null;a&&a.nodeType?(a=this.getXML(a)[0])&&(d=a.getElementsByTagName("formdata")[0]):b&&(d=this.getXML().map(function(a){return $A(a.getElementsByTagName("formdata"))}).flatten().find(function(a){var d=a.getElementsByTagName("objectname")[0],a=a.getAttribute("id")==b,d=c?d?d.firstChild.nodeValue==c:!1:!0;return a&&d}));return d},parseAttributes:function(a){for(var b={},c=0,d=a.attributes.length;c<d;c++){var e=a.attributes[c];b[e.nodeName.toUpperCase()]=e.nodeValue}return b}},util:{numberFormat:!1,
clean:function(a,b){if("undefined"!=typeof a&&a){if("string"==typeof a)a=this._cleanString(a);else if("object"==typeof a)if(a.length)for(var c=0;c<a.length;c++)a[c]=this.clean(a[c]);else if("undefined"!=typeof a.value)a.value=this._cleanString(a.value);else for(c in a)"string"==typeof a[c]?a[c]=this._cleanString(a[c]):"object"==typeof a[c]&&b&&(a[c]=this.clean(a[c],b));return a}},_cleanString:function(a){a=a.replace(/(<([^>]+)>)/ig," ");a=a.replace(/\\/ig,"");return a=a.strip()},checkNumberFormat:function(){-1!=
(2.5).toLocaleString().indexOf(",")&&(this.formatNumber=!0)},format:function(a){"undefined"!=typeof a.longitude&&(a.longitude=a.longitude.toString().replace(",","."));"undefined"!=typeof a.latitude&&(a.latitude=a.latitude.toString().replace(",","."));return a},select:function(a,b){return Prototype.Browser.IE&&9>document.documentMode?document.getElementsByClassName(b,a):$(a).select("."+b)},createTextNode:function(a,b){return Prototype.Browser.IE&&"number"===typeof b?(new ActiveXObject("Microsoft.XMLDOM")).createTextNode(b.toString()):
Prototype.Browser.IE?(new ActiveXObject("Microsoft.XMLDOM")).createTextNode(b):a.createTextNode(b)},alert_:function(a,b){var c=Object.extend({type:"alert",height:230,width:500,opacity:0.95,draggable:!1,resizable:!1},b||{});return new LITBox(a,c)},alert:function(a,b){if("undefined"==typeof myLightWindow||null==myLightWindow)return this.alert_(a,b);this.checkAlertTemplate();$("lightwindow_cache_data").innerHTML=a;var c=$("lightwindow_cache"),d=c.readAttribute("params"),e,f;e=b&&b.close_text?b.close_text:
$("close_text")&&0<$("close_text").innerHTML.length?$("close_text").innerHTML:"Close";f=b&&b.title_text?b.title_text:$("title_text")&&0<$("title_text").innerHTML.length?$("title_text").innerHTML:"Notice";d&&(d.lightwindow_title&&""!=d.lightwindow_title)&&(f=d.lightwindow_title);d=Object.extend({type:"inline",opacity:0.95,draggable:!1,resizable:!1,closetext:e,title:f,params:d},b||{});d.noListeners=!0;"undefined"==typeof d.finalAnimationHandler&&(d.finalAnimationHandler=!1);f="undefined"!=typeof myLightWindow?
myLightWindow:new lightwindow(d);f.activateWindow(Object.extend({href:"#lightwindow_cache",content:c,type:"inline",transitionHandler:!0,hideLoadingHTML:!0},d));$("lightwindow_title_bar_close_link").innerHTML=e;$("lightwindow_cache_data").innerHTML="";return f},alertExternal:function(a){var b=""!=a.readAttribute("href")?a.readAttribute("href"):a.href,c=a.readAttribute("url"),d=a.readAttribute("title"),e=a.readAttribute("params");$("lightwindow_cache");a=$("close_text")&&0<$("close_text").innerHTML.length?
$("close_text").innerHTML:"Close";d||$("title_text")&&0<$("title_text").innerHTML.length&&$("title_text");b={href:c&&""!=c?c:b,type:"external",closetext:a,params:e,title:d,noListeners:!0};c=new lightwindow(b);c.activateWindow(b);$("lightwindow_title_bar_close_link")&&($("lightwindow_title_bar_close_link").innerHTML=a);$("lightwindow_cache_data")&&($("lightwindow_cache_data").innerHTML="");return c},checkAlertTemplate:function(){var a=$("lightwindow_cache_data"),b=$("lightwindow_cache"),c=$("templates"),
d;if(!c){c=document.createElement("div");$(c).writeAttribute("id","templates");$(c).writeAttribute("style","display:none;");var e=$$("body")[0],f=$("lightwindow_overlay"),g=e.childNodes.length,g=2<g?g-2:g-1;f?f.insert({before:c}):e.childNodes[g].insert({before:c})}b||(d=document.createElement("div"),$(d).writeAttribute("id","lightwindow_cache"),a&&d.appendChild(a),c.appendChild(d));a||(a=document.createElement("div"),$(a).writeAttribute("id","lightwindow_cache_data"),$(a).writeAttribute("style","line-height: auto;padding-top: 20px;padding-bottom: 20px;position: relative;float: left;width: 100%;"),
b?b.appendChild(a):d.appendChild(a));return!0},removeChildren:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},cleanWhitespace:function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];3==c.nodeType&&!/\S/.test(c.nodeValue)&&(a.removeChild(c),b--);1==c.nodeType&&this.cleanWhitespace(c)}return a},Try:function(){for(var a,b=0;b<arguments.length;b++){var c=arguments[b];try{a=c();break}catch(d){}}return a},retrieveGetVals:function(){return document.location.search.parseQuery()},
setCookie:function(a,b,c,d,e,f){var g=new Date;g.setTime(g.getTime());c&&(c*=864E5);g=new Date(g.getTime()+c);document.cookie=a+"="+escape(b)+(c?";expires="+g.toGMTString():"")+(d?";path="+d:"")+(e?";domain="+e:"")+(f?";secure":"")},deleteCookie:function(a,b){this.setCookie(a,"",-30,null,b,0)},getCookie:function(a){var b=document.cookie.split(";"),c="",d="",e="";for(i=0;i<b.length;i++)if(c=b[i].split("="),d=c[0].replace(/^\s+|\s+$/g,""),d==a)return 1<c.length&&(e=unescape(c[1].replace(/^\s+|\s+$/g,
""))),e;return null},cookieCheck:function(a){this.deleteCookie("test_cookie",document.domain);this.setCookie("test_cookie","test_cookie",30,null,document.domain,0);if(!this.getCookie("test_cookie"))return $(a).innerHTML="You must have cookies enabled to use this application.",!1;this.deleteCookie("test_cookie",document.domain);return!0},evalExpression:function(a,b,c){switch(c){case "eq":return a==b;case "neq":return a!=b;case "gt":return a>b;case "lt":return a<b;case "ge":return a>=b;case "le":return a<=
b}return!1},addTimeout:function(a){if(!a||0>=a)a=60;Ajax.Responders.register({onCreate:function(b){b.timeoutId=window.setTimeout(function(){var a;a:switch(b.transport.readyState){case 1:case 2:case 3:a=!0;break a;default:a=!1}if(a&&(b.transport.abort(),document.fire("w2gi:ajaxTimeOut",{request:b}),b.options.onFailure))b.options.onFailure(b.transport,b.json)},1E3*a)},onComplete:function(a){window.clearTimeout(a.timeoutId)}})},loadLocale:function(){var a="en";if(window.google&&google.maps&&google.maps.Language&&
google.maps.Language.getLanguageCode)a=google.maps.Language.getLanguageCode();else if(!(a=navigator.language))if(!(a=navigator.browserLanguage))if(!(a=navigator.systemLanguage))a=navigator.userLanguage;a=a.toLowerCase().substr(0,2);ace.language=a},convertMeters:function(a,b,c){b=b?b:"2";c=c?c:ace._distanceuom;switch((c?c:"mile").toLowerCase()){case "mile":a=3.281*a/5280;break;case "km":a/=1E3}return this.roundNumber(a,b)},convertSeconds:function(a,b,c){b=b?b:"2";c=c?c:ace._timeuom;switch((c?c:"minute").toLowerCase()){case "minute":a/=
60;break;case "hour":a/=3600}return this.roundNumber(a,b)},roundNumber:function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}},locationmanager:{getAccountXML:function(){var a=$("accounts");return(a=a?a.getValue():!1)?"<account>"+a+"</account>":""},logout:function(a,b){var c=ace.xml.getXMLData("ajaxurl"),d="<request><appkey>"+ace.xml.getXMLData("appkey")+'</appkey><formdata id="logout"></formdata></request>';ace.ajaxRequest(c,d,function(){document.body.innerHTML='<div style="text-align: center; position: relative; top: 100px;"><table style="margin: 0pt auto; text-align: left;"><tbody><tr><td colspan="2" style="text-align: right;"><a href="http://www.where2getit.com"><img width="171" height="32" src="/w2gi/images/w2gi_banner.png" alt="Go to Where2GetIt Home" title="Go to Where2GetIt Home" style="border: 0pt none ;"/></a></td></tr><tr><td>Thank you, click here to <a href="login.html">Login</a></td></tr></tbody></table></div>'},
b)}},click:{track:function(a){var b=ace.xml.getXMLData("ajaxurl"),c=ace.xml.getXMLData("appkey"),d=Math.random();ace.ajaxRequest(b,"<request><appkey>"+c+'</appkey><formdata id="clicktrack" like="'+d+'"><action>'+a.action+"</action><value>"+a.value+"</value></formdata></request>",!1)},pageObserve:function(a){a.each(function(a){document.observe("click",function(c){if(c&&c.element()){var c=c.element().readAttribute(a),d={action:a,value:c};c&&(""!=c&&null!=c&&void 0!=c)&&ace.click.track(d)}})})},elementObserve:function(a,
b){b.each(function(b){$(a).observe("click",function(a){if(a&&a.element()){var a=a.element().readAttribute(b),e={action:b,value:a};a&&(""!=a&&null!=a&&void 0!=a)&&ace.click.track(e)}}.bind(this))})}},filters:{active:{},process:function(a,b){if("object"==typeof b)return b;a=a.toLowerCase();for(i in this.active)if(i=i.toLowerCase(),a==i)return this[this.active[i]](b);return b},processRecord:function(a){for(i in a)a[i]=this.process(i,a[i]);return a},url:function(a){return"string"==typeof a&&!a.blank()&&
!a.match(/^([a-zA-Z]{3,7}:)/i)?"http://"+a:a},surl:function(a){return"string"==typeof a&&!a.blank()&&!a.match(/^([a-zA-Z]{3,7}:)/i)?"https://"+a:a},ftp:function(a){return"string"==typeof a&&!a.blank()&&!a.match(/^([a-zA-Z]{3,7}:)/i)?"ftp://"+a:a},sftp:function(a){return"string"==typeof a&&!a.blank()&&!a.match(/^([a-zA-Z]{3,7}:)/i)?"sftp://"+a:a}}};
ace.util.events={on:function(a,b){if("undefined"!=typeof customEvents)for(var c in customEvents.eventNameMap)if(a==customEvents.eventNameMap[c].newEventName||a==c){var d=customEvents.node||document;switch(customEvents.lib||"Prototype"){case "jQuery":if("undefined"!=typeof jQuery)jQuery(d).on(a,b);break;case "Prototype":0==a.indexOf("w2gi:")?a=a.slice(5):0==a.indexOf("w2gi_:")&&(a=a.slice(6));if(d==window)return;d.on("w2gi_:"+a,function(a){b(a)})}}},trigger:function(a){if("undefined"!=typeof customEvents){var b=
a.eventName;if("undefined"!=typeof customEvents.eventNameMap[b]){var c=customEvents.eventNameMap[b].newEventName||b,d=customEvents.node||document;switch(customEvents.lib||"Prototype"){case "jQuery":if("undefined"!=typeof jQuery){var e=jQuery.Event(c);"function"==typeof customEvents.eventNameMap[b].beforeTrigger?customEvents.eventNameMap[b].beforeTrigger(a,function(b){"undefined"!=typeof b?(e.memo=b,jQuery(d).trigger(e,b)):(e.memo=a.memo,jQuery(d).trigger(e,a.memo))}):(e.memo=a.memo,jQuery(d).trigger(e,
a.memo))}break;case "Prototype":if(0==c.indexOf("w2gi:")?c=c.slice(5):0==c.indexOf("w2gi_:")&&(c=c.slice(6)),"function"==typeof customEvents.eventNameMap[b].beforeTrigger)customEvents.eventNameMap[b].beforeTrigger(a,function(b){d!=window&&("undefined"!=typeof b?d.fire("w2gi_:"+c,b):d.fire("w2gi_:"+c,a.memo))});else{if(d==window)break;d.fire("w2gi_:"+c,a.memo)}}}}},addTriggers:function(){for(var a in customEvents.eventNameMap)document.observe(a,function(a){ace.util.events.trigger(a)})}};
ace.template={templates:null,initialize:function(){this.templates={};$("templates").childElements().each(function(a){this.templates[a.readAttribute("id")]=a}.bind(this));try{Prototype.Browser.IE6&&$("templates")&&$("templates").select(".alpha").invoke("applyFilter")}catch(a){}},destroy:function(){this.templates=null},updateLocation:function(a,b,c){a=$(a);b=this.getTemplate(b,c);a.update(b)},getTemplate:function(a,b){return!this.templates[a]?null:b?this.templates[a].populate(b):this.templates[a]},
getIconTemplate:function(a,b){return this.getTemplate(a,b)||this._generateIconTemplate(a).populate(b)},getTableTemplate:function(a,b,c){var d=a.tBodies[0].innerHTML,e=a.getAttribute("id");c||(c={});if(!("undefined"==typeof custom_ob||null===custom_ob)&&custom_ob.updateHFRecords)c=custom_ob.updateHFRecords(b,c);var f=this._getTemplateHeadFoot(a,"thead",c),a=this._getTemplateHeadFoot(a,"tfoot",c),b=this._getRows(b,d);return"<table id='"+e+"'>"+f+a+"<tbody>"+b+"</tbody></table>"},getDivTemplate:function(a,
b,c){var d=a.select(".div_body")[0].innerHTML,e=a.getAttribute("id");c||(c={});var f=this._getTemplateDivHeadFoot(a,".div_head",c),a=this._getTemplateDivHeadFoot(a,".div_foot",c),b=this._getDivs(b,d);return"<div id='"+e+"'>"+f+b+a+"</div>"},getULTemplate:function(a,b,c){var d=a.select(".ul_body")[0].innerHTML;$A(a.classList).join(" ");c||(c={});var e=this._getTemplateDivHeadFoot(a,".ul_head",c),a=this._getTemplateDivHeadFoot(a,".ul_foot",c),b=this._getDivs(b,d);return e+b+a},getMultiTableTemplates:function(a,
b,c){var d=[];if(custom&&custom.templates){var e=$H(custom.templates),f=[],g=0;e.each(function(a){d.push([ace.template.getTemplate(a.key),a.key]);f.push([]);g=a[1].noprev_header&&""!=a[1].noprev_header&&!g?1:g}.bind(this))}b.each(function(a){var b=0,c=d[b][1];if(c){for(c=$H(e.get(c));!this._checkOp(c,a)&&b+1<d.length;){b++;c=d[b][1];if(!c)return;c=$H(e.get(c))}f[b]&&f[b].push(a)}}.bind(this));if(g){var h=0,l=1;f.each(function(a,b){var c=d[b][0].getElementsByClassName("cond_title"),f=d[b][1];0<a.length&&
(c=c[0],a.each(function(a){a.RECNUM=a.POINUM=l++}),c.innerHTML=0==h?e._object[f].noprev_header:e._object[f].prev_header,h++)}.bind(this))}b="";for(i=0;i<f.length;i++){var k=Object.clone(c);k.COUNT=f[i].size();var m=a.readAttribute("show_empty");0==k.COUNT&&"false"==m||(b+=this.getTableTemplate(d[i][0],f[i],k))}b="<tr><td>"+b+"</td></tr>";k=this._getTemplateHeadFoot(a,"thead",c);a=this._getTemplateHeadFoot(a,"tfoot",c);return'<table class="poi-container">'+k+a+"<tbody>"+b+"</tbody></table>"},getMultiDivTemplates:function(a,
b,c){var d=[];if(custom&&custom.templates){var e=$H(custom.templates),f=[],g=0;e.each(function(a){d.push([ace.template.getTemplate(a.key),a.key]);f.push([]);g=a[1].noprev_header&&""!=a[1].noprev_header&&!g?1:g}.bind(this))}b.each(function(a){var b=0,c=d[b][1];if(c){for(c=$H(e.get(c));!this._checkOp(c,a)&&b+1<d.length;){b++;c=d[b][1];if(!c)return;c=$H(e.get(c))}f[b]&&f[b].push(a)}}.bind(this));if(g){var h=0;f.each(function(a,b){var c=d[b][0].getElementsByClassName("cond_title"),f=d[b][1];0<a.length&&
(c[0].innerHTML=0==h?e._object[f].noprev_header:e._object[f].prev_header,h++)}.bind(this))}b="";for(i=0;i<f.length;i++){var l=Object.clone(c);l.COUNT=f[i].size();var k=a.readAttribute("show_empty");0==l.COUNT&&"false"==k||(b+=this.getDivTemplate(d[i][0],f[i],l))}l=this._getTemplateHeadFoot(a,"thead",c);a=this._getTemplateHeadFoot(a,"tfoot",c);return'<div class="poi-container">'+l+a+b+"</div>"},_checkOp:function(a,b){check=!0;checkprev=!1;a._object.checks.each(function(c,d){a._object.multi_operator?
0==d?check=checkprev=!Object.isArray(c)&&c.checks?this._checkOp($H(c),b):this._checkSwitch(b[c[0].toUpperCase()],c[2],c[1]):(checkprev=!Object.isArray(c)&&c.checks?this._checkOp($H(c),b):this._checkSwitch(b[c[0].toUpperCase()],c[2],c[1]),check=this._checkSwitch(checkprev,check,a._object.multi_operator)):check&&(check=!Object.isArray(c)&&c.checks?this._checkOp($H(c),b):this._checkSwitch(b[c[0].toUpperCase()],c[2],c[1]))}.bind(this));return check},_checkSwitch:function(a,b,c){c=c.toLowerCase();switch(c){case "eq":return a==
b;case "neq":return a!=b;case "gt":return a>b;case "lt":return a<b;case "ge":return a>=b;case "le":return a<=b;case "or":return a||b;case "and":return a&&b}return!1},_getTemplateHeadFoot:function(a,b,c){return(a=a.getElementsByTagName(b)[0])?"<"+b+">"+a.innerHTML.interpolate(c)+"</"+b+">":""},_getTemplateDivHeadFoot:function(a,b,c){a=a.select(b);return 0<a.length?a[0].innerHTML.interpolate(c):""},_getRows:function(a,b){for(var c="",d=0,e=a.length;d<e;d++)c+=this._getRow(b,a[d]);return c},_getRow:function(a,
b){var c=a.interpolate(b);if(!c.include("templateid"))return c;var d=new Element("div");d.innerHTML="<table><tbody>"+c+"</tbody></table>";$A(d.getElementsByTagName("div")).each(function(a){var c=a.getAttribute("templateid");c&&(c=ace.template.getIconTemplate(c,b),c.removeAttribute("id"),c.removeAttribute("offsetx"),c.removeAttribute("offsety"),c.removeAttribute("bubbleid"),a.appendChild(c))});return d.firstChild.tBodies[0].innerHTML},_getDivs:function(a,b){for(var c="",d=0,e=a.length;d<e;d++)c+=this._getDiv(b,
a[d]);return c},_getDiv:function(a,b){return a.interpolate(b)},_generateIconTemplate:function(a){var b=new Element("div",{id:"iconID",className:"icon",bubbleid:"bubble",width:"33",height:"28",offsetx:"-16",offsety:"-28"}),a=new Element("img",{className:"alpha",src:"/w2gi/images/icons/"+a+".png"});Prototype.Browser.IE6&&a.applyFilter();b.insert(a);b.insert((new Element("div",{action:"open_bubble",recnum:"#{POINUM}"})).insert("#{POINUM}"));return this.templates.iconID=b}};
ace.table={data:{},records:[],_slices:[],_sliceIndex:null,_options:null,_sortOrders:null,_lastSortOrder:null,update:function(a,b,c,d){function e(){if(d&&("locatorsearch"==d.formdataID||"productsearch"==d.formdataID||"baselocatorsearch"==d.formdataID))ace.cgeo.geocode(b,f.bind(this),d);else return ace.request(b,f.bind(this),d)}function f(b){this.updateFromResponseXML(a,b);return Object.isFunction(c)?c(b):!1}var g=a.tagName&&a.id?a.id:a;this.data[g]||(this.data[g]={records:[],options:{}});switch(a){case "event_search_panel":b=
b.serialize(!0);Object.extend(b,{eventdate:b.fromDate+","+b.toDate});Object.extend(d,{formdataID:"getlist"});break;case "coupon_container":b=b.serialize(!0),g=ace.util.retrieveGetVals(),Object.extend(b,$H(g))}a=$(a);if(ace.useClientSideGeo)"undefined"==typeof ace.cgeo||null==ace.cgeo?document.observe("w2gi:acecgeoloaded",function(){e.bind(this)()}.bind(this)):e.bind(this)();else return ace.request(b,f.bind(this),d)},updateFromResponseXML:function(a,b){a=$(a);this.data[a.id]||(this.data[a.id]={records:[],
options:{}});var c=ace.xml.getCollection(b,"multiple_address")||ace.xml.getCollection(b),d=ace.xml.getCollection(b,"event");d&&(d.childNodes&&0!=d.childNodes.length)&&(d=ace.xml.parse(d),ace.table.data[a.id].eventPOIs=this._getEventPOIs(d));if((d=ace.xml.getCollection(b,"social"))&&d.childNodes&&0!=d.childNodes.length)d=ace.xml.parse(d),ace.table.data[a.id].socialPOIs=this._getSocialPOIs(d);if((d=ace.xml.getCollection(b,"value"))&&d.childNodes&&0!=d.childNodes.length)d=ace.xml.fullDepthXMLParser(d).VALUE,
ace.table.data[a.id].valuePOIs=this._getValuePOIs(d);if((d=ace.xml.getCollection(b,"reviewcount"))&&d.childNodes&&0!=d.childNodes.length)d=ace.xml.parse(d),ace.table.data[a.id].badreviewPOIs=this._getBadReviewPOIs(d);if((d=ace.xml.getCollection(b,"reviews"))&&d.childNodes&&0!=d.childNodes.length)d=ace.xml.parse(d),ace.table.data[a.id].reviewPOIs=this._getReviewPOIs(d);d=(d=ace.xml.findDeepestElement(c))?d.parentNode.tagName:null;if(!d)return!1;d=c.getElementsByTagName(d);c=ace.xml.parseAttributes(c);
d=ace.xml.parseNodes(d);ace.table.data[a.id]&&(ace.table.data[a.id].valuePOIs||ace.table.data[a.id].badreviewPOIs||ace.table.data[a.id].socialPOIs)&&d.each(function(b){var c=0,d=0,h=0,l=0,k;ace.table.data[a.id].valuePOIs&&ace.table.data[a.id].valuePOIs[b.UID]&&((ace.table.data[a.id].valuePOIs[b.UID]||[]).each(function(a){c+=+(a.VALUE||0)}.bind(this)),(k=ace.template.getTemplate("generated_value_template"))&&(b.VALUE_HTML=k.innerHTML.interpolate({VALUE:c})));ace.table.data[a.id].badreviewPOIs&&ace.table.data[a.id].badreviewPOIs[b.UID]&&
((ace.table.data[a.id].badreviewPOIs[b.UID]||[]).each(function(a){d+=+(a.BADREVIEWS||0)}.bind(this)),(k=ace.template.getTemplate("bad_reviews_template"))&&(b.REVIEWS_HTML=k.innerHTML.interpolate({CLIENTKEY:b.CLIENTKEY,NUM:d,UOM:1==d?"Bad Review":"Bad Reviews"})));if(ace.table.data[a.id].socialPOIs&&ace.table.data[a.id].socialPOIs[b.CLIENTKEY]){var m=ace.table.data[a.id].socialPOIs[b.CLIENTKEY]||[];m.each(function(a){h+=+(a.LIKES||0);l+=+(a.CHECKINS||0)}.bind(this));if(k=ace.template.getTemplate("social_url_template"))"TABLE"==
k.tagName&&0<k.tBodies.length?b.SOCIAL_URLS=ace.template.getTableTemplate(k,m):"DIV"==k.tagName&&0<k.select(".div_body").length?b.SOCIAL_URLS=ace.template.getDivTemplate(k,m):"UL"==k.tagName&&0<k.select(".ul_body").length?b.SOCIAL_URLS=ace.template.getULTemplate(k,m):(b.SOCIAL_URLS=[],m.each(function(a){b.SOCIAL_URLS.push(k.innerHTML.interpolate(Object.extend({DISPLAY:a.DATASOURCE},a)))}.bind(this)),0<b.SOCIAL_URLS.length&&(b.SOCIAL_URLS=b.SOCIAL_URLS.join(" - ")));(k=ace.template.getTemplate("checkins_template"))&&
(b.CHECKINS_HTML=k.innerHTML.interpolate({NUM:l,UOM:1==l?"Checkin":"Checkins"}));(k=ace.template.getTemplate("likes_template"))&&(b.LIKES_HTML=k.innerHTML.interpolate({NUM:h,UOM:1==h?"Like":"Likes"}))}}.bind(this));if(ace.filters)for(i in d)ace.filters.processRecord(d[i]);this.updateFromRecords(a,d,c)},updateFromRecords:function(a,b,c){var d=a.id?a.id:"";if(!(Object.isArray(b)&&0>=b.length)&&(this.data[d]||(this.data[d]={records:[],options:{}}),b&&(this.data[d].records=b,this.data[d].options._sortOrders=
{},this.data[d].options._lastSortOrder=null),a=$(d))){var b="collection_"+(c?c.NAME:"poi"),e=ace.template.getTemplate(b);this.data[d].options.type=e.tagName.toLowerCase();Object.extend(this.data[d].options,this._parseOptions(e));this.data[d].options._slices=this.data[d].options.sliceSize?this.data[d].records.eachSlice(this.data[d].options.sliceSize):[];this.data[d].options._sliceIndex=this.data[d].options.sliceSize?0:null;if(!("undefined"==typeof custom_ob||null===custom_ob)&&custom_ob.updateRecords)this.data[d].records=
custom_ob.updateRecords(this.data[d].records);var f=this.data[d].options.sliceSize?this.data[d].options._slices.first():this.data[d].records,c=c||{};Object.extend(c,{COUNT:""+this.data[d].records.length});Object.extend(c,this._getSliceInfo(d));c.MAPURL&&c.MAPURL.match("getdirectionsmap")&&(c.MOBILEMAPURL=c.MAPURL,c.EMAILMAPURL=c.MAPURL,c.MOBILEMAPURL=c.MOBILEMAPURL.gsub("getdirectionsmap","smsdirectionstart"),c.EMAILMAPURL=c.EMAILMAPURL.gsub("getdirectionsmap","emaildirectionstart"));var g="";"table"==
this.data[d].options.type&&(g=!("undefined"==typeof custom||null===custom)&&("collection_poi"==b||custom.templateID)&&custom.templates?ace.template.getMultiTableTemplates(e,f,c):ace.template.getTableTemplate(e,f,c));"div"==this.data[d].options.type&&(g=!("undefined"==typeof custom||null===custom)&&("collection_poi"==b||custom.templateID)&&custom.templates?ace.template.getMultiDivTemplates(e,f,c):ace.template.getDivTemplate(e,f,c));"ul"==this.data[d].options.type&&(g=ace.template.getULTemplate(e,f,
c));this.data[d].options.attributes=c?c:{};a.update(g);a.scrollTop=0;a.fire("w2gi:updated",f);f=a.down();g=a.down("#foot")?a.down("#foot"):null;this._updateRowColors(f,this.data[d].options);this.data[d].options._observerAdded||("collection_multiple_address"==b&&(e=ace.template.getTemplate("collection_poi")),this._addPanelObserver(e,a,c),this.data[d].options._observerAdded=!0);(ace.table.data[d].eventPOIs||ace.table.data[d].socialPOIs)&&this._updatePanel(f,this.data[d].options._sliceIndex,a);this._hideNav(f,
"prev_results");g&&this._hideNav(g,"prev_results");this.data[d].options._sliceIndex>=this.data[d].options._slices.length-1&&(this._hideNav(f,"next_results"),g&&this._hideNav(g,"next_results"))}},getRecord:function(a,b){return this.data[b].records.find(function(b){return b.RECNUM==a})},getReviewRecord:function(a,b){if(this.data[b].reviewPOIs)return this.data[b].reviewPOIs[a]},getSocialRecord:function(a,b){if(this.data[b].socialPOIs)return this.data[b].socialPOIs[a]},getEventRecord:function(a,b){if(this.data[b].eventPOIs)return this.data[b].eventPOIs[a]},
removeRecord:function(a,b){var c=this.getRecord(a,b);this.data[b].records=this.data[b].records.without(c);var d=parseInt(a);this.data[b].records.each(function(a){var b=parseInt(a.RECNUM);b>d&&(a.RECNUM=""+--b,a.POINUM=a.RECNUM)});return c},addRecord:function(a,b){this.data[b]&&this.data[b].records?(a.RECNUM=""+(this.data[b].records.length+1),a.POINUM=a.RECNUM,this.data[b].records.push(a)):(this.data[b]={records:[],options:{}},a.RECNUM="1",a.POINUM=a.RECNUM,this.data[b].records=[a]);return a},editRecord:function(a,
b){var c=parseInt(a.RECNUM)-1;return Object.extend(this.data[b].records[c],a)},getSlice:function(a){var b=this.data[a].options._sliceIndex;return null!=b&&this.data[a].options._sliceIndex<=this.data[a].options._slices.length?this.data[a].options._slices[b]:null},updateActiveRow:function(a,b){this.updateRowClass(a,"activeRowClass",b)},highlightRow:function(a,b){this.updateRowClass(a,"highlightRowClass",b)},updateRowClass:function(a,b,c){var d=a.up().id;if(this.data[d].options)var e=this.data[d].options[b];
if(e){b=a.getElementsBySelector("tr[recnum]");b.length||(b=a.getElementsBySelector("div[recnum]"));a=0;for(d=b.length;a<d;a++)c==b[a].readAttribute("recnum")?b[a].addClassName(e):b[a].removeClassName(e)}},sortCurrRecords:function(a,b,c){this.sortRecords(a,b,c);this.updateFromRecords($(c));if(b=$("order"))b.value=a,b=$(c).select(".sortorder"),0<b.length&&b.each(function(b){b=b.select("select")[0];b.value=a;Event.observe(b,"change",function(a){var b=$F(a.target),a=a.target.options[a.target.selectedIndex].readAttribute("field_type");
ace.table.sortCurrRecords(b,a||"",c)}.bind(this))}.bind(this));$$(".sortorder").each(function(b){b.select("select")[0].value=a}.bind(this))},sortRecords:function(a,b,c){var d=a.split(","),e=d[0].split(" "),f=!1;"object"==typeof e&&(e=e[0],f=!0);0>=this.data[c].records.length||(this.data[c].options._sortOrders[a]&&this.data[c].options._lastSortOrder==a&&!f?this.data[c].records.reverse():(d.reverse(),d.each(function(d){var e=d.split(" "),f="object"==typeof e&&1<e.length?e[1].toLowerCase():"asc",d="object"==
typeof e?e[0]:e;switch(b){case "text":this.data[c].records=this.data[c].records.sort(function(a,b){return"asc"==f?a[d].localeCompare(b[d]):b[d].localeCompare(a[d])}.bind(this));break;case "number":this.data[c].records=this.data[c].records.sort(function(a,b){var c="asc"==f?parseFloat(a[d])-parseFloat(b[d]):parseFloat(b[d])-parseFloat(a[d]);return isNaN(c)?"asc"==f?a[d].localeCompare(b[d]):b[d].localeCompare(a[d]):c}.bind(this));break;case "date":this.data[c].records=this.data[c].records.sort(function(a,
b){a[d].indexOf("/");var c=/^(\d{4})[\/\- ](\d{2})[\/\- ](\d{2})/,e=/^(\d{2})[\/\- ](\d{2})[\/\- ](\d{4})/;if(c.exec(a[d]))var h=c.exec(a[d]),n=c.exec(b[d])||[0,1,1,1],h=new Date(h[1],1*h[2]-1,h[3]),n=new Date(n[1],1*n[2]-1,n[3]);else if(e.exec(a[d]))h=e.exec(a[d]),n=e.exec(b[d])||[0,1,1,1],h=new Date(h[3],1*h[1]-1,h[2]),n=new Date(n[3],1*n[1]-1,n[2]);else if(-1!=a[d].toLowerCase().indexOf("jan")||-1!=a[d].toLowerCase().indexOf("feb")||-1!=a[d].toLowerCase().indexOf("mar")||-1!=a[d].toLowerCase().indexOf("apr")||
-1!=a[d].toLowerCase().indexOf("may")||-1!=a[d].toLowerCase().indexOf("jun")||-1!=a[d].toLowerCase().indexOf("jul")||-1!=a[d].toLowerCase().indexOf("aug")||-1!=a[d].toLowerCase().indexOf("sep")||-1!=a[d].toLowerCase().indexOf("oct")||-1!=a[d].toLowerCase().indexOf("nov")||-1!=a[d].toLowerCase().indexOf("dec"))h=new Date(a[d]),n=new Date(b[d]);return"asc"==f?h>n:n>h}.bind(this));break;default:this.data[c].records=this.data[c].records.sort(function(a,b){var c="asc"==f?parseFloat(a[d])-parseFloat(b[d]):
parseFloat(b[d])-parseFloat(a[d]);return isNaN(c)?"asc"==f?a[d].localeCompare(b[d]):b[d].localeCompare(a[d]):c}.bind(this))}this.data[c].options._sortOrders[a]=!0;this.data[c].options._lastSortOrder=a}.bind(this))),this.data[c].records.each(function(a,b){a.RECNUM=b+1;a.POINUM=b+1}.bind(this)))},_updateRowColors:function(a,b){if(b&&b.oddRowClass&&b.evenRowClass){var c=a.getElementsBySelector("tr[recnum]");c||(c=a.getElementsBySelector("div[recnum]"));for(var d=0,e=c.length;d<e;d++)c[d].addClassName(0==
d%2?b.evenRowClass:b.oddRowClass)}},_addPanelObserver:function(a,b,c){b.observe("click",function(d){switch(d.element().readAttribute("action")){case "prev_results":d.stop();this._updatePrev(a,b,c);break;case "next_results":d.stop();this._updateNext(a,b,c);break;case "event":d.stop();var e=d.element().readAttribute("uid"),d=d.element().readAttribute("locationuid");this._openEvent(e,d,b.id);break;case "event_search":d.stop(),d=d.element().readAttribute("locationuid"),this._createEventSearch(d)}}.bind(this))},
_createEventSearch:function(a){var a=this._getCalHTML(a),b=Object.extend({type:"alert",height:230,width:500,opacity:0.95},{});this._eventSearchLitbox=new LITBox(a,b);this._observeEventSearch()},_observeEventSearch:function(){this._dateDiv=$("search_popup_container");for(var a=this._dateDiv.select(".cal"),b=this._dateDiv.select(".calButton"),c=0;c<a.length;c++)this._initCalendar(a[c],b[c]);$("event_search_submit").observe("click",function(a){a.stop();ace.table.update("event_search_panel",$("event_search_form"),
null,{})}.bind(this))},_initCalendar:function(a,b){Calendar.setup({inputField:a.id,ifFormat:"%m/%d/%Y",button:b.id,onClose:this._onClose.bind(this)})},_onClose:function(a){a.hide()},_getCalHTML:function(a){var b=new Date,c,d=new Date;d.setDate(b.getDate());c=this._getCalendarCaption(d);d.setDate(b.getDate()+7);b=this._getCalendarCaption(d);d='<div id="search_popup_container"><form id="event_search_form"><span class="cal_copy"><input caption="From" size="8"  id="fromDate" type="text" name="fromDate" ';
d+=' value="'+c+'" class="cal inputsm" />';d+=" </span> ";d+='<span class="cal_img"><img id="btn_from" class="calButton" src="/w2gi/images/calendar.gif" width="19" height="18"/></span>&nbsp;&nbsp;&nbsp;';d+='<span class="cal_copy">';d+='<input caption="To" size="8"  id="toDate" type="text" name="toDate" ';d+=' value="'+b+'" class="cal inputsm" />';d+=" </span> ";d+='<span class="cal_img"><img id="btn_to" class="calButton" src="/w2gi/images/calendar.gif" width="19" height="18"/></span>&nbsp;&nbsp;&nbsp;';
d+='<xml style="display: none;"><root><inputform><formdata id="getlist"><objectname>EventLocator</objectname><events><where><eventstartdate><between></between></eventstartdate></where></events><where><locationuid><eq></eq></locationuid></where></formdata></inputform></root></xml>';d+='<input type="hidden" name="locationuid" value="'+a+'"/>';d+='<input type="submit" id="event_search_submit" value="Find Events" />';d+="</form>";d+='<div id="event_search_panel"></div>';return d+="</div>"},daysInMonth:function(a,
b){return(new Date(b,a,0)).getDate()},_openEvent:function(a,b,c){var d=ace.template.getTemplate("event_popup").innerHTML,e={};ace.table.data[c].eventPOIs[b].each(function(b){b.UID==a&&(e=b)}.bind(this));b=d.interpolate(e);c=Object.extend({type:"alert",height:230,width:500,opacity:0.95},{});return this._eventLitbox=new LITBox(b,c)},_updatePrev:function(a,b,c){var d=b.id;this.data[d].options._sliceIndex--;var e=this.getSlice(d),f=this._getSliceInfo(d);Object.extend(c,f);f="";"table"==this.data[d].options.type&&
(f=ace.template.getTableTemplate(a,e,c));"div"==this.data[d].options.type&&(f=ace.template.getDivTemplate(a,e,c));"ul"==this.data[d].options.type&&(f=ace.template.getULTemplate(a,e,c));b.update(f);b.fire("w2gi:sliceUpdated",e);a=b.down();c=b.down("#foot")?b.down("#foot"):null;this._updateRowColors(a,this.data[d].options);(this.data[d].eventPOIs||this.data[d].socialPOIs)&&this._updatePanel(a,this.data[d].options._sliceIndex,b);0>=this.data[d].options._sliceIndex&&(this._hideNav(a,"prev_results"),c&&
this._hideNav(c,"prev_results"))},_updateNext:function(a,b,c){var d=b.id;this.data[d].options._sliceIndex++;var e=this.getSlice(d),f=this._getSliceInfo(d);Object.extend(c,f);Object.extend(c,{COUNT:""+this.data[d].records.length});f="";"table"==this.data[d].options.type&&(f=ace.template.getTableTemplate(a,e,c));"div"==this.data[d].options.type&&(f=ace.template.getDivTemplate(a,e,c));"ul"==this.data[d].options.type&&(f=ace.template.getULTemplate(a,e,c));b.update(f);b.fire("w2gi:sliceUpdated",e);a=b.down();
c=b.down("#foot")?b.down("#foot"):null;this._updateRowColors(a,this.data[d].options);(this.data[d].eventPOIs||this.data[d].socialPOIs)&&this._updatePanel(a,this.data[d].options._sliceIndex,b);this.data[d].options._sliceIndex>=this.data[d].options._slices.length-1&&(this._hideNav(a,"next_results"),c&&this._hideNav(c,"next_results"))},_getSliceInfo:function(a){if(null==this.data[a].options._sliceIndex)return{};var b=this.data[a].options._slices[this.data[a].options._sliceIndex].length,c=0==this.data[a].options._sliceIndex?
1:this.data[a].options._sliceIndex*this.data[a].options.sliceSize+1;return{SLICE_START:c,SLICE_END:c+(this.data[a].options._sliceIndex<this.data[a].options._slices.length-1?this.data[a].options.sliceSize:b)-1,SLICE_PREV_SIZE:0<this.data[a].options._sliceIndex?this.data[a].options._slices[this.data[a].options._sliceIndex-1].length:0,SLICE_NEXT_SIZE:this.data[a].options._sliceIndex<this.data[a].options._slices.length-1?this.data[a].options._slices[this.data[a].options._sliceIndex+1].length:0,PAGENO:this.data[a].options._sliceIndex+
1,PAGES:this.data[a].options._slices.length}},_hideNav:function(a,b){a.select("."+b).invoke("hide")},_parseOptions:function(a){return{oddRowClass:a.readAttribute("odd_row_class"),evenRowClass:a.readAttribute("even_row_class"),activeRowClass:a.readAttribute("active_row_class"),highlightRowClass:a.readAttribute("highlight_row_class"),sliceSize:parseInt(a.readAttribute("slice_size"))}},_getEventPOIs:function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a[c].LOCATIONUID]?b[a[c].LOCATIONUID].push(a[c]):b[a[c].LOCATIONUID]=
[a[c]];return b},_getSocialPOIs:function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a[c].CLIENTKEY]?b[a[c].CLIENTKEY].push(a[c]):b[a[c].CLIENTKEY]=[a[c]];return b},_getReviewPOIs:function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a[c].CLIENTKEY]?b[a[c].CLIENTKEY].push(a[c]):b[a[c].CLIENTKEY]=[a[c]];return b},_getValuePOIs:function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a[c].UID]?b[a[c].UID].push(a[c]):b[a[c].UID]=[a[c]];return b},_getBadReviewPOIs:function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a[c].UID]?
b[a[c].UID].push(a[c]):b[a[c].UID]=[a[c]];return b},_getCalendarCaption:function(a){var b=a.getMonth()+1,b=10>b?"0"+b:""+b,c=a.getDate();return b+"/"+c+"/"+a.getFullYear()},_updatePanel:function(a,b,c){var d=ace.util.select(c,"poi_events"),e=ace.util.select(c,"poi_checkins"),c=c.id||c;if(this.data[c].options._slices&&this.data[c].options._slices[b])for(var f=0,g=this.data[c].options._slices[b].length;f<g;f++){var a=this.data[c].options._slices[b][f],h,l;this.data[c].eventPOIs&&(h=this.data[c].eventPOIs[a.UID]);
this.data[c].socialPOIs&&(l=this.data[c].socialPOIs[a.CLIENTKEY]);h&&0<h.length&&(a=ace.template.getTemplate("events"),a="table"==a.tagName.toLowerCase()?ace.template.getTableTemplate(a,h):ace.template.getDivTemplate(a,h),d[f].update(a).show());l&&0<l.length&&(a=ace.template.getTemplate("checkins"),a="table"==a.tagName.toLowerCase()?ace.template.getTableTemplate(a,l):ace.template.getDivTemplate(a,l),e[f].update(a).show())}else if(!this.data[c].options.sliceSize){f=0;for(g=this.data[c].records.length;f<
g;f++)a=this.data[c].records[f],this.data[c].eventPOIs&&(h=this.data[c].eventPOIs[a.UID]),this.data[c].socialPOIs&&(l=this.data[c].socialPOIs[a.CLIENTKEY]),h&&0<h.length&&(a=ace.template.getTemplate("events"),a="table"==a.tagName.toLowerCase()?ace.template.getTableTemplate(a,h):ace.template.getDivTemplate(a,h),d[f].update(a).show()),l&&0<l.length&&(a=ace.template.getTemplate("checkins"),a="table"==a.tagName.toLowerCase()?ace.template.getTableTemplate(a,l):ace.template.getDivTemplate(a,l),e[f].update(a).show())}}};
ace.collection={updateOptions:function(a,b,c,d,e){function f(b){var e=$(a);this._updateTarget(e,b,c);return Object.isFunction(d)?d(b):!1}var g="State"==b&&c?{country:$F(c)}:null,h=ace.xml.getFormData(null,"getlist",b);h?(b=ace.xml.getXMLData("ajaxurl"),g=ace._getRequestXML(h,g),ace.ajaxRequest(b,g,f.bind(this),e)):ace.util.alert("Please add the <inputform> element in the XML data island for the "+b+" object.",{height:100})},appendOptions:function(a,b,c,d,e,f,g,h){function l(a){var b="";$H(a).each(function(a){var c=
"object"==typeof a.value?l(a.value):a.value;b+="<"+a.key+">"+c+"</"+a.key+">"});return b}var k=ace.xml.getXMLData("ajaxurl"),m=h&&h.like?' like="'+Math.random()+'"':"",b="<request><appkey>"+ace.xml.getXMLData("appkey")+'</appkey><formdata id="getlist"'+m+"><objectname>"+b+"</objectname>";c&&(b+=l({where:c}));h&&h.order&&(b+="<order>"+h.order+"</order>");ace.ajaxRequest(k,b+"</formdata></request>",function(b){var c=$(a);$A(b.getElementsByTagName(d)).map(function(a){var b=a.getElementsByTagName(e)[0].firstChild.nodeValue,
a=a.getElementsByTagName(f)[0].firstChild.nodeValue,a=(new Element("option")).update(a);b&&a.setAttribute("value",b);c.appendChild(a)});return Object.isFunction(g)?g(b):!1}.bind(this),h)},updateForm:function(a,b,c,d,e){function f(a){var b=a.getElementsByTagName("response")[0].firstChild,b=ace.util.cleanWhitespace(b),c="";$A(b.firstChild.getElementsByTagName("*")).each(function(a){a.firstChild&&(""!=c&&(c+="&"),c+=a.tagName+"="+a.firstChild.nodeValue)});Form.deserialize(g,c);return Object.isFunction(d)?
d(a):!1}var g=$(a),a=ace.xml.getXML()[0];(a=ace.collection._getFormData(a,b))?(b=ace.xml.getXMLData("ajaxurl"),a=ace._getRequestXML(a),ace.ajaxRequest(b,a,f,e)):ace.util.alert("Please add the <inputform> element in the XML data island for the "+b+" object.",{height:100})},updateTable:function(a,b,c,d){function e(b){ace.table.updateFromResponseXML(a,b);return Object.isFunction(c)?c(b):!1}var f=ace.xml.getXML()[0];(f=ace.collection._getFormData(f,b))?(b=ace.xml.getXMLData("ajaxurl"),f=ace._getRequestXML(f),
ace.ajaxRequest(b,f,e.bind(this),d)):ace.util.alert("Please add the <inputform> element in the XML data island for the "+b+" object.",{height:100})},_updateTarget:function(a,b,c){switch(ace.xml.getCollectionName(b)){case "industry":this._processName(a,b);break;case "country":this._processCountry(a,b,c);break;case "state":this._processName(a,b);break;default:this._processName(a,b)}},_processCountry:function(a,b,c){b=$A(b.getElementsByTagName("country")).map(function(a){return{name:a.getElementsByTagName("name")[0].firstChild.nodeValue,
description:a.getElementsByTagName("description")[0].firstChild.nodeValue}});b.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b.each(function(b){this._addOption(a,b.description,b.name,c)}.bind(this))},_processName:function(a,b){var c=$A(b.getElementsByTagName("name")).map(function(a){return a.firstChild.nodeValue});ace.util.removeChildren(a);c.sort().each(function(b){this._addOption(a,b,b)}.bind(this))},_addOption:function(a,b,c,d){b=(new Element("option")).update(b);
c&&(b.setAttribute("value",c),c==d&&b.setAttribute("selected","selected"));a.appendChild(b)},_getFormData:function(a,b){return $A(a.getElementsByTagName("formdata")).find(function(a){return a.getElementsByTagName("objectname")[0].firstChild.nodeValue==b})}};
ace.directions={addresses:null,searchInfo:null,supportedCountries:null,search:function(a,b,c,d,e,f,g,h){function l(){ace.cdirections.init()&&(!0===g.clientsidedirections?q=!0:!1===g.clientsidedirections?q=!1:d.any(function(a){return!this.supportCountry(a)}.bind(this))&&(q=!0));if(q){var a=b.getElementsByTagName("map")?b.getElementsByTagName("map")[0]:null,e;if(a&&(e=a.getElementsByTagName("size")?a.getElementsByTagName("size")[0]:null))e=Prototype.Browser.IE?e.text:e.innerHTML,e=e.replace(",","x");
var a=b.getElementsByTagName("distanceuom")?b.getElementsByTagName("distanceuom")[0]:null,f=ace._distanceuom;a&&(f=Prototype.Browser.IE?a.text:a.innerHTML);e={mapsize:e,distanceuom:f};ace.cdirections.search(this.addresses,this.searchInfo,p,k.bind(this),e)}else e=ace.xml.getXMLData("ajaxurl"),a=this._generateRequestXML(b,c,this.addresses,this.searchInfo,p),ace.ajaxRequest(e,a,m.bind(this),g)}function k(b){if("OK"==b.status)ace.table.updateFromRecords(a,b.records,b.attributes),f(b);else if(g&&"function"==
typeof g.onError){var c="";switch(b.status){case "NOT_FOUND":c="Either the start or end address could not be geocoded.";break;case "INVALID_REQUEST":c="Invalid request.";break;default:c=b.status}c='<response code="5000"><message><text>'+c+"</text></message></response>";window.DOMParser?b=(new DOMParser).parseFromString(c,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(c));g.onError(b)}}function m(b){ace.table.updateFromResponseXML(a,b);var c={records:ace.table.data[a.id].records,
attributes:ace.table.data[a.id].options.attributes,status:"OK",source:"W2GI"};if("multiple_address"==c.attributes.NAME){for(var d=null,e=Prototype.Browser.IE?$A(ace.xml.getCollection(b,"address").childNodes):Element.childElements(ace.xml.getCollection(b,"address")),g=0;g<e.length;g++){var h=e[g];if("collection"==h.tagName&&"multiple_address"==h.getAttribute("name")){d={addresses:h.getElementsByTagName("address"),index:g};h.removeAttribute("name");break}}c.addresses=d}else d=ace.xml.getCollection(b,
"address").getElementsByTagName("address"),c.addresses=ace.xml.parseNodes(d);if((b=ace.xml.getCollection(b,"pois"))&&b.childNodes&&0!=b.childNodes.length)c.pois=ace.xml.parse(b);return f(c)}this._getSupportedCountries();this.addresses=d?d:this.addresses.reverse();e?this.searchInfo=e:this.searchInfo&&(this.searchInfo.action="From"==this.searchInfo.action?"To":"From");var p=h&&h.nodeType?Form.serialize(h,!0):h,q=!1;!c&&ace.useClientSideDir?ace.cdirections?l.bind(this)():document.observe("w2gi:acecdirectionsloaded",
l.bind(this)):(e=ace.xml.getXMLData("ajaxurl"),h=this._generateRequestXML(b,c,this.addresses,this.searchInfo,p),ace.ajaxRequest(e,h,m.bind(this),g))},_generateRequestXML:function(a,b,c,d,e){return"<request><appkey>"+ace.xml.getXMLData("appkey")+"</appkey>"+(d?"<uid>"+d.uid+"</uid>":"<uid></uid>")+(d?"<action>"+d.action+"</action>":"<action></action>")+ace.xml.toString(this._getQueryXML(a,b,c,e))+"</request>"},_getQueryXML:function(a,b,c,d){var e=ace.util.cleanWhitespace(a.cloneNode(!0)),f=Prototype.Browser.IE?
document.getElementsByTagName("xml")[0]:document;b||(a=e.getElementsByTagName("atw")[0])&&a.parentNode.removeChild(a);c.each(function(a,b){var d=e.getElementsByTagName("geoloc")[b];if(Object.isString(a)){var k=d.getElementsByTagName("addressline")[0],m=d.getElementsByTagName("latitude")[0],d=d.getElementsByTagName("longitude")[0];k.appendChild(ace.util.createTextNode(f,a));if(c.action&&(k=c.action,"From"==k&&1==b||"To"==k&&0==b))m.appendChild(ace.util.createTextNode(f,c.latitude)),d.appendChild(ace.util.createTextNode(f,
c.longitude));if(c[2]){var p;0==b?(k=c[2].latitude,p=c[2].longitude):(k=c[2].dest_latitude,p=c[2].dest_longitude);m.appendChild(ace.util.createTextNode(f,k));d.appendChild(ace.util.createTextNode(f,p))}}else if(2>b)for(property in a=this.lowerCaseObject(a),a)(m=d.getElementsByTagName(property)[0])&&m.appendChild(ace.util.createTextNode(f,a[property]))}.bind(this));d&&$H(d).each(function(a){var b="";if("addressline"!=a.key&&""!=a.value){var c=e.getElementsByTagName(a.key)[0];"country"==a.key&&(b=e.getElementsByTagName(a.key)[1]);
if(c){var d=!1,m="";Object.isArray(a.value)?(m=a.value.join("|"),d=!0):a.value.include("|")?(d=!0,a.value=a.value.split("|")):m=a.value;c.firstChild&&"country"!=a.key?1==c.firstChild.nodeType?(a=c.firstChild.nodeValue,c.firstChild.appendChild(ace.util.createTextNode(f,null==a?m:a+"|"+m))):c.replaceChild(ace.util.createTextNode(f,m),c.firstChild):"country"==a.key?!0==d?(0==c.childNodes.length&&c.appendChild(ace.util.createTextNode(f,a.value[0])),0==b.childNodes.length&&b.appendChild(ace.util.createTextNode(f,
a.value[1]))):"To"!=this.searchInfo.action?0==c.childNodes.length&&c.appendChild(ace.util.createTextNode(f,m)):0==b.childNodes.length&&b.appendChild(ace.util.createTextNode(f,m)):0==c.childNodes.length&&c.appendChild(ace.util.createTextNode(f,m))}}}.bind(this));return e},_getSupportedCountries:function(){function a(a){this.supportedCountries=ace.xml.parse(a).pluck("NAME")}this.supportedCountries||ace.request({directions:"<eq>1</eq>"},a.bind(this),{formdataID:"getlist",objectName:"Country",tagName:"where"})},
supportCountry:function(a){if("string"==typeof a)return!0;if(a.COUNTRY)return this.supportedCountries.include(a.COUNTRY.toUpperCase());if(a.country)return this.supportedCountries.include(a.country.toUpperCase())},lowerCaseObject:function(a){var b={},c;for(c in a)b[c.toLowerCase()]=a[c];return b}};ace.history={initialize:function(){},add:function(){}};ace.history.initialize();
ace.locale={locales:{},current:null,loadLocale:function(a,b,c){function d(a){a=a.getElementsByTagName("text")[0];a=(a.text?a.text:a.textContent).evalJSON(!0);this.current=this.locales[a.locale]=a;this._setLocale();Object.isFunction(b)&&b(this.current)}function e(a){Object.isFunction(c)?(a=a.getElementsByTagName("text")[0],c(a.text||a.textContent)):b(this.current)}var f=this.locales[a];if(f)this.current=f,this._setLocale(),Object.isFunction(b)&&b(this.current);else{var f=ace.xml.getXMLData("ajaxurl"),
g="<request><appkey>"+ace.xml.getXMLData("appkey")+'</appkey><formdata id="getlocaleinfo">';a&&(g+="<locale>"+a+"</locale>");return ace.ajaxRequest(f,g+"</formdata></request>",d.bind(this),{alertError:!1,onError:e})}},_setLocale:function(){$$("*[msgid]").each(function(a){var b=a.readAttribute("msgid");a.innerHTML=ace.locale.gettext(b)})},gettext:function(a,b){var c=(b&&this.locales[b]?this.locales[b].mappings:this.current.mappings)[a];return void 0!=c?c:a},getTextXML:function(a){return a.replace(/ msgid="([^"]+)">([^<]*?)</g,
function(a,c){return">"+ace.locale.gettext(c)+"<"})}};ace.xml.fullDepthXMLParser=function(a){var b=a;if(a.documentElement)b=a.documentElement;else if(!Object.isElement(a))throw"Arggument is not a Document or Node";for(var a={},b=Element.childElements(b),c=0;c<b.length;c++){var d=this._fullDepthXMLParser(b[c]);if("undefined"!=typeof a[d[0]]){if("undefined"==typeof a[d[0]].push){var e=[];e.push(a[d[0]]);a[d[0]]=e}a[d[0]].push(d[1])}else a[d[0]]=d[1]}return a};
ace.xml._fullDepthXMLParser=function(a){var b=Element.childElements(a);if(0<b.length){for(var c={},d=0;d<b.length;d++){var e=this._fullDepthXMLParser(b[d]);if("undefined"!=typeof c[e[0]]){if("undefined"==typeof c[e[0]].push){var f=[];f.push(c[e[0]]);c[e[0]]=f}c[e[0]].push(e[1])}else c[e[0]]=e[1]}return[a.tagName.toUpperCase(),c]}return[a.tagName.toUpperCase(),ace.xml.getNodeValue(a)]};
ace.xml.fullDepthXMLGenerator=function(a,b){var c="",d;for(d in a){var e=a[d];if(Object.isArray(e))if(b.flattenArrays)c+="<"+d+">"+e.join(",")+"</"+d+">";else for(var f=0;f<e.length;f++)c+="<"+d+">"+ace.xml.fullDepthXMLGenerator(e[0])+"</"+d+">";else if("object"==typeof e){var f="<"+d,e=Object.clone(e),g="",h;for(h in e)/^_/.test(h)&&(f+=" "+h.replace(/^_/,"")+'="'+e[h]+'"',delete e[h]);g=this.fullDepthXMLGenerator(e);f+=">"+g+"</"+d+">";c+=f}else c+="<"+d+">"+e+"</"+d+">"}return c};
(function(){if(!window.google||!google.gears){var a=null;if("undefined"!=typeof GearsFactory)a=new GearsFactory;else try{a=new ActiveXObject("Gears.Factory"),-1!=a.getBuildInfo().indexOf("ie_mobile")&&a.privateSetGlobalObject(this)}catch(b){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(a=document.createElement("object"),a.style.display="none",a.width=0,a.height=0,a.type="application/x-googlegears",document.documentElement.appendChild(a),a&&"undefined"==
typeof a.create&&(a=null))}a&&(window.google||(google={}),google.gears||(google.gears={factory:a}))}})();var bb_success,bb_error,bb_blackberryTimeout_id=-1;function handleBlackBerryLocationTimeout(){-1!=bb_blackberryTimeout_id&&bb_error({message:"Timeout error",code:3})}
function handleBlackBerryLocation(){clearTimeout(bb_blackberryTimeout_id);bb_blackberryTimeout_id=-1;if(bb_success&&bb_error){if(0==blackberry.location.latitude&&0==blackberry.location.longitude)bb_error({message:"Position unavailable",code:2});else{var a=null;blackberry.location.timestamp&&(a=new Date(blackberry.location.timestamp));bb_success({timestamp:a,coords:{latitude:blackberry.location.latitude,longitude:blackberry.location.longitude}})}bb_error=bb_success=null}}
var geo_position_js=function(){var a={},b=null;a.showMap=function(a,b){"undefined"!=typeof blackberry?blackberry.launch.newMap({latitude:1E5*a,longitude:1E5*-b}):window.location="http://maps.google.com/maps?q=loc:"+a+","+b};a.getCurrentPosition=function(a,d,e){b.getCurrentPosition(a,d,e)};a.init=function(){try{if("undefined"!=typeof geo_position_js_simulator)b=geo_position_js_simulator;else if("undefined"!=typeof bondi&&"undefined"!=typeof bondi.geolocation)b=bondi.geolocation;else if("undefined"!=
typeof navigator.geolocation)b=navigator.geolocation,a.getCurrentPosition=function(a,c,f){b.getCurrentPosition(function(b){"undefined"!=typeof b.latitude?a({timestamp:b.timestamp,coords:{latitude:b.latitude,longitude:b.longitude}}):a(b)},c,f)};else if("undefined"!=typeof window.blackberry&&blackberry.location.GPSSupported){if("undefined"==typeof blackberry.location.setAidMode)return!1;blackberry.location.setAidMode(2);a.getCurrentPosition=function(a,b,c){bb_success=a;bb_error=b;bb_blackberryTimeout_id=
c.timeout?setTimeout("handleBlackBerryLocationTimeout()",c.timeout):setTimeout("handleBlackBerryLocationTimeout()",6E4);blackberry.location.onLocationUpdate("handleBlackBerryLocation()");blackberry.location.refreshLocation()};b=blackberry.location}else"undefined"!=typeof window.google&&"undefined"!=typeof google.gears?(b=google.gears.factory.create("beta.geolocation"),a.getCurrentPosition=function(a,c,f){b.getCurrentPosition(function(b){"undefined"!=typeof b.latitude?a({timestamp:b.timestamp,coords:{latitude:b.latitude,
longitude:b.longitude}}):a(b)},c,f)}):"undefined"!=typeof Mojo&&"Mojo.Service.Request"!=typeof Mojo.Service.Request?(b=!0,a.getCurrentPosition=function(a,b,c){parameters={};c&&(c.enableHighAccuracy&&!0==c.enableHighAccuracy&&(parameters.accuracy=1),c.maximumAge&&(parameters.maximumAge=c.maximumAge),c.responseTime&&(5>c.responseTime?parameters.responseTime=1:20>c.responseTime?parameters.responseTime=2:parameters.timeout=3));r=new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",
parameters:parameters,onSuccess:function(b){a({timestamp:b.timestamp,coords:{latitude:b.latitude,longitude:b.longitude,heading:b.heading}})},onFailure:function(a){1==a.errorCode?b({code:3,message:"Timeout"}):2==a.errorCode?b({code:2,message:"Position unavailable"}):b({code:0,message:"Unknown Error: webOS-code"+errorCode})}})}):"undefined"!=typeof device&&"undefined"!=typeof device.getServiceObject&&(b=device.getServiceObject("Service.Location","ILocation"),a.getCurrentPosition=function(a,c){b.ILocation.GetLocation({LocationInformationClass:"BasicLocationInformation"},
function(b,g,h){4==g?c({message:"Position unavailable",code:2}):a({timestamp:null,coords:{latitude:h.ReturnValue.Latitude,longitude:h.ReturnValue.Longitude,altitude:h.ReturnValue.Altitude,heading:h.ReturnValue.Heading}})})})}catch(c){return"undefined"!=typeof console&&console.log(c),!1}return null!=b};return a}();
Event.observe(window,"load",function(){function a(){$$("xml div").invoke("remove");$$("xml [class]").invoke("removeAttribute","class");$$("xml [CLASS]").invoke("removeAttribute","CLASS");$$("xml [abp]").invoke("removeAttribute","abp");$$("xml [sab]").invoke("removeAttribute","sab")}var b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(b){var c=new b(a),d={attributes:!0,childList:!0,characterData:!0},e=function(a,b,c){if(0<a.children.length)for(var d=0;d<a.children.length;d++)e(a.children[d],
b,c);b.observe(a,c)};$$("xml").each(function(a){e(a,c,d)},this)}else setInterval(a,500);a()});
